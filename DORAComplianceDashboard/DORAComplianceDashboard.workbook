{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# DORA 2022/2554 Digital Operational Resilience Compliance Dashboard\n\n**Version 1.0** | January 2026"
      },
      "name": "text - title"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "1f74ed9a-e3ed-498d-bd5b-f68f3836a117",
            "version": "KqlParameterItem/1.0",
            "name": "Subscriptions",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "8c4e5f32-3b2d-4d8f-9e5c-7a6b8c9d0e1f",
            "version": "KqlParameterItem/1.0",
            "name": "ResourceGroups",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\n| summarize by resourceGroup\n| order by resourceGroup asc\n| project value = resourceGroup, label = resourceGroup, selected = false",
            "crossComponentResources": [
              "{Subscriptions}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "9d5e6f70-4c3b-5e6d-8f7a-1b2c3d4e5f60",
            "version": "KqlParameterItem/1.0",
            "name": "DORAArticle",
            "label": "DORA Article Filter",
            "type": 2,
            "isHiddenWhenLocked": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"All\", \"label\": \"ğŸ“‹ All Articles\", \"selected\": true}, {\"value\": \"9.3a\", \"label\": \"9.3a - ICT Systems Availability\"}, {\"value\": \"9.3b\", \"label\": \"9.3b - Access Control\"}, {\"value\": \"9.3c\", \"label\": \"9.3c - Data Protection\"}, {\"value\": \"9.3d\", \"label\": \"9.3d - Identity & Auth\"}, {\"value\": \"10.1\", \"label\": \"10.1 - Detection & Monitoring\"}, {\"value\": \"10.2\", \"label\": \"10.2 - Incident Response\"}]",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "a1b2c3d4-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
            "version": "KqlParameterItem/1.0",
            "name": "ShowHelp",
            "label": "Show Help & Info",
            "type": 2,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"Yes\", \"label\": \"ğŸ“– Show Help\"}, {\"value\": \"No\", \"label\": \"ğŸ”’ Hide Help\"}]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "No"
          },
          {
            "id": "tab-selector-param",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedTab",
            "label": "Section",
            "type": 2,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"Summary\", \"label\": \"ğŸ“Š Executive Summary\"}, {\"value\": \"9.3a\", \"label\": \"ğŸ¯ 9.3a Availability\"}, {\"value\": \"9.3b\", \"label\": \"ğŸ” 9.3b Access Control\"}, {\"value\": \"9.3c\", \"label\": \"ğŸ›¡ï¸ 9.3c Data Protection\"}, {\"value\": \"9.3d\", \"label\": \"ğŸ‘¤ 9.3d Identity\"}, {\"value\": \"10.1\", \"label\": \"ğŸ” 10.1 Monitoring\"}, {\"value\": \"10.2\", \"label\": \"ğŸ“‹ 10.2 Logging\"}, {\"value\": \"Analytics\", \"label\": \"ğŸ“ˆ Analytics\"}]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "Summary"
          },
          {
            "id": "overview-tab-param",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedCategoryTab",
            "label": "Category",
            "type": 2,
            "isRequired": true,
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[{\"value\": \"Overview\", \"label\": \"ğŸ“– Overview\"}, {\"value\": \"Dashboard\", \"label\": \"ğŸ“Š Dashboard\"}, {\"value\": \"Thresholds\", \"label\": \"âš™ï¸ Thresholds\"}]",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "Dashboard"
          },
          {
            "id": "threshold-zone-excellent",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdZoneExcellent",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "90",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-zone-good",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdZoneGood",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "75",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-zone-warning",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdZoneWarning",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "50",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-zone-critical",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdZoneCritical",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "25",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-paas-excellent",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdPaaSExcellent",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "90",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-paas-good",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdPaaSGood",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "75",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-paas-warning",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdPaaSWarning",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "50",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-paas-critical",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdPaaSCritical",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "25",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-https-excellent",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdHTTPSExcellent",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "98",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-https-good",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdHTTPSGood",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "90",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-https-warning",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdHTTPSWarning",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "50",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-https-critical",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdHTTPSCritical",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "25",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-kv-excellent",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdKVExcellent",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "95",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-kv-good",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdKVGood",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "70",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-kv-warning",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdKVWarning",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "40",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-kv-critical",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdKVCritical",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "20",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-aad-excellent",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdAADExcellent",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "95",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-aad-good",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdAADGood",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "70",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-aad-warning",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdAADWarning",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "40",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-aad-critical",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdAADCritical",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "20",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-defender-good",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdDefenderGood",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "80",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-defender-warning",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdDefenderWarning",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "40",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-defender-critical",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdDefenderCritical",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "20",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-nsg-excellent",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdNSGExcellent",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "90",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-nsg-good",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdNSGGood",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "70",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-nsg-warning",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdNSGWarning",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "40",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-nsg-critical",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdNSGCritical",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "20",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-risk-medium",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdRiskMedium",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "5",
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "threshold-risk-high",
            "version": "KqlParameterItem/1.0",
            "name": "ThresholdRiskHigh",
            "type": 1,
            "isHiddenWhenLocked": true,
            "value": "15",
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - filters"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n## âš™ï¸ Compliance Threshold Configuration\n\nCustomize the percentage thresholds that determine compliance status colors (ğŸŸ¢ Excellent, ğŸŸ¡ Good, ğŸŸ  Warning,  Critical) for each executive summary metric. Adjust these values to match your organization's compliance standards."
      },
      "conditionalVisibility": {
        "parameterName": "ShowHelp",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "threshold-header-text"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "ğŸ—ï¸ Article 9.3a - Availability Thresholds",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-zone-excellent",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdZoneExcellent",
                  "label": "ğŸŸ¢ Zone Redundancy - Excellent (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "90"
                },
                {
                  "id": "threshold-zone-good",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdZoneGood",
                  "label": "ğŸŸ¡ Zone Redundancy - Good (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "75"
                },
                {
                  "id": "threshold-zone-warning",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdZoneWarning",
                  "label": "ğŸŸ  Zone Redundancy - Warning (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "50"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "zone-thresholds"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-paas-excellent",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdPaaSExcellent",
                  "label": "ğŸŸ¢ PaaS Network - Excellent (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "90"
                },
                {
                  "id": "threshold-paas-good",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdPaaSGood",
                  "label": "ğŸŸ¡ PaaS Network - Good (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "75"
                },
                {
                  "id": "threshold-paas-warning",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdPaaSWarning",
                  "label": "ğŸŸ  PaaS Network - Warning (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "50"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "paas-thresholds"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-https-excellent",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdHTTPSExcellent",
                  "label": "ğŸŸ¢ Secure Transfer - Excellent (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "95"
                },
                {
                  "id": "threshold-https-good",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdHTTPSGood",
                  "label": "ğŸŸ¡ Secure Transfer - Good (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "80"
                },
                {
                  "id": "threshold-https-warning",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdHTTPSWarning",
                  "label": "ğŸŸ  Secure Transfer - Warning (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "50"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "https-thresholds"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ShowHelp",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "availability-thresholds-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "ğŸ” Article 9.3b/9.3d - Access Control & Identity Thresholds",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-kv-excellent",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdKVExcellent",
                  "label": "ğŸŸ¢ Key Vault RBAC - Excellent (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "90"
                },
                {
                  "id": "threshold-kv-good",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdKVGood",
                  "label": "ğŸŸ¡ Key Vault RBAC - Good (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "70"
                },
                {
                  "id": "threshold-kv-warning",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdKVWarning",
                  "label": "ğŸŸ  Key Vault RBAC - Warning (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "40"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "kv-thresholds"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-aad-excellent",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdAADExcellent",
                  "label": "ğŸŸ¢ AAD-Only Auth - Excellent (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "90"
                },
                {
                  "id": "threshold-aad-good",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdAADGood",
                  "label": "ğŸŸ¡ AAD-Only Auth - Good (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "70"
                },
                {
                  "id": "threshold-aad-warning",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdAADWarning",
                  "label": "ğŸŸ  AAD-Only Auth - Warning (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "40"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "aad-thresholds"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ShowHelp",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "access-thresholds-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "ğŸ” Article 10 - Monitoring & Logging Thresholds",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-defender-good",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdDefenderGood",
                  "label": "ğŸŸ¡ Defender Coverage - Good (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "70"
                },
                {
                  "id": "threshold-defender-warning",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdDefenderWarning",
                  "label": "ğŸŸ  Defender Coverage - Warning (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "40"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "defender-thresholds"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-nsg-excellent",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdNSGExcellent",
                  "label": "ğŸŸ¢ NSG Flow Logs - Excellent (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "90"
                },
                {
                  "id": "threshold-nsg-good",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdNSGGood",
                  "label": "ğŸŸ¡ NSG Flow Logs - Good (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "70"
                },
                {
                  "id": "threshold-nsg-warning",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdNSGWarning",
                  "label": "ğŸŸ  NSG Flow Logs - Warning (%)",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "40"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "nsg-thresholds"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ShowHelp",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "monitoring-thresholds-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "âš ï¸ Business Continuity Risk Levels",
        "expandable": true,
        "expanded": false,
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "threshold-risk-medium",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdRiskMedium",
                  "label": "ğŸŸ¡ Medium Risk - Max % non-redundant resources",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "10"
                },
                {
                  "id": "threshold-risk-high",
                  "version": "KqlParameterItem/1.0",
                  "name": "ThresholdRiskHigh",
                  "label": "ğŸŸ  High Risk - Max % non-redundant resources",
                  "type": 1,
                  "typeSettings": {
                    "parameterType": "number"
                  },
                  "value": "25"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "risk-thresholds"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "ShowHelp",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "risk-thresholds-group"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "category-tab-overview",
            "cellValue": "SelectedCategoryTab",
            "linkTarget": "parameter",
            "linkLabel": "ğŸ“– Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "category-tab-dashboard",
            "cellValue": "SelectedCategoryTab",
            "linkTarget": "parameter",
            "linkLabel": "ğŸ“Š Dashboard",
            "subTarget": "Dashboard",
            "style": "link"
          },
          {
            "id": "category-tab-thresholds",
            "cellValue": "SelectedCategoryTab",
            "linkTarget": "parameter",
            "linkLabel": "âš™ï¸ Thresholds",
            "subTarget": "Thresholds",
            "style": "link"
          }
        ]
      },
      "name": "category-tabs"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## ğŸ›¡ï¸ DORA 2022/2554 Digital Operational Resilience Compliance Dashboard\n\nThe objective of this workbook is to provide comprehensive visibility into your Azure environment's compliance with the **Digital Operational Resilience Act (DORA) EU 2022/2554**. This regulation mandates stringent ICT risk management, incident reporting, and operational resilience requirements for financial institutions operating in the European Union.\n\n### What is DORA?\n\nThe Digital Operational Resilience Act (DORA) establishes a comprehensive regulatory framework for managing ICT (Information and Communication Technology) risks in the financial sector. It applies to:\n\n- **Credit institutions** (banks, payment institutions)\n- **Investment firms**\n- **Insurance and reinsurance undertakings**\n- **ICT third-party service providers**\n\nKey requirements include:\n\n- **Article 9.3a**: ICT systems must be designed, configured, and maintained to ensure **availability, authenticity, integrity, and confidentiality**\n- **Article 9.3b**: Robust **access control mechanisms** to protect against unauthorized access\n- **Article 9.3c**: Strong **data protection** measures including encryption at rest and in transit\n- **Article 9.3d**: **Identity and authentication** controls including privileged access management\n- **Article 10.1**: Comprehensive **detection and monitoring** capabilities\n- **Article 10.2**: Detailed **logging and audit trails** for forensic analysis\n\n### How to Use This Workbook\n\nThis workbook analyzes your Azure resources against DORA requirements using Azure Resource Graph queries. It provides:\n\n1. **Executive Summary**: High-level compliance metrics for leadership reporting\n2. **Article-Specific Views**: Detailed assessments organized by DORA article\n3. **Resource-Level Details**: Actionable findings for each non-compliant resource\n4. **Analytics**: Trends and patterns across your environment\n\n**Filters Available**:\n- ğŸ“Œ **Subscriptions**: Select one or more Azure subscriptions\n- ğŸ“ **Resource Groups**: Filter by specific resource groups\n- ğŸ·ï¸ **Tags**: Filter by custom tag names and values\n- ğŸ“– **Show Help**: Toggle detailed explanations and guidance\n\n### Getting Started\n\n1. Select your **subscriptions** and **resource groups** using the filters above\n2. Navigate to the **Dashboard** tab to view compliance data\n3. Start with the **Executive Summary** for a high-level overview\n4. Drill into specific **DORA articles** (9.3a, 9.3b, 9.3c, 9.3d, 10.1, 10.2) for detailed findings\n5. Use the **Analytics** tab to identify trends and prioritize remediation\n\n> **Note**: This workbook provides guidance based on common DORA compliance patterns. Always consult with your compliance and legal teams to ensure full regulatory alignment.\n\n---\n\n<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg> **Have feedback?** We'd love to hear from you! Share your thoughts on this workbook.\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"19px\" height=\"19px\" viewBox=\"0 0 19 18\" version=\"1.1\"><g id=\"surface1\"><path style=\" stroke:none;fill-rule:evenodd;fill:rgb(14.117647%,16.078431%,18.431373%);fill-opacity:1;\" d=\"M 9.472656 0 C 4.234375 0 0 4.125 0 9.226562 C 0 13.308594 2.714844 16.761719 6.476562 17.984375 C 6.945312 18.074219 7.121094 17.785156 7.121094 17.539062 C 7.121094 17.324219 7.105469 16.59375 7.105469 15.828125 C 4.46875 16.378906 3.921875 14.726562 3.921875 14.726562 C 3.496094 13.660156 2.871094 13.382812 2.871094 13.382812 C 2.007812 12.820312 2.933594 12.820312 2.933594 12.820312 C 3.890625 12.878906 4.390625 13.765625 4.390625 13.765625 C 5.238281 15.171875 6.601562 14.773438 7.152344 14.53125 C 7.230469 13.933594 7.480469 13.519531 7.746094 13.292969 C 5.644531 13.078125 3.433594 12.285156 3.433594 8.738281 C 3.433594 7.730469 3.808594 6.90625 4.40625 6.265625 C 4.3125 6.035156 3.984375 5.085938 4.5 3.820312 C 4.5 3.820312 5.300781 3.574219 7.105469 4.765625 C 7.875 4.566406 8.671875 4.460938 9.472656 4.460938 C 10.269531 4.460938 11.085938 4.566406 11.839844 4.765625 C 13.644531 3.574219 14.441406 3.820312 14.441406 3.820312 C 14.960938 5.085938 14.628906 6.035156 14.535156 6.265625 C 15.148438 6.90625 15.507812 7.730469 15.507812 8.738281 C 15.507812 12.285156 13.296875 13.0625 11.179688 13.292969 C 11.527344 13.582031 11.824219 14.132812 11.824219 15.003906 C 11.824219 16.242188 11.808594 17.234375 11.808594 17.539062 C 11.808594 17.785156 11.980469 18.074219 12.453125 17.984375 C 16.214844 16.761719 18.925781 13.308594 18.925781 9.226562 C 18.941406 4.125 14.695312 0 9.472656 0 Z M 9.472656 0 \"/></g></svg> **Found an issue?** Report bugs or request features on GitHub."
            },
            "name": "overview-introduction"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "ğŸ“‹ Changelog & Version History",
              "expandable": true,
              "expanded": false,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### Version 1.3 (January 2026)\n\n**New Features**:\n- âœ… **Configurable Compliance Thresholds**: Added dynamic threshold parameters that appear when \"Show Help\" is enabled\n  - Zone Redundancy Coverage thresholds (Excellent/Good/Warning)\n  - PaaS Network Isolation thresholds\n  - Secure Transfer (HTTPS/TLS) thresholds\n  - Key Vault RBAC thresholds\n  - AAD-Only Authentication thresholds\n  - Microsoft Defender Coverage thresholds\n  - NSG Flow Logs thresholds\n  - Business Continuity Risk levels (Medium/High/Critical)\n- âœ… **User-Adjustable Parameters**: Customize compliance scoring without editing KQL queries\n- âœ… **Overview Tab**: Added collapsible documentation sections (Changelog, Features, Usage)\n- âœ… **Two-Tier Navigation**: Category tabs (Overview/Dashboard) + Dashboard sub-tabs\n\n**Improvements**:\n- ğŸ“ All threshold values now parameterized for easy customization\n- ğŸ“ Threshold configuration panel accessible via \"Show Help\" toggle\n- ğŸ“ Updated documentation to reflect new threshold customization capabilities\n\n---\n\n### Version 1.2 (January 2026)\n\n**New Features**:\n- âœ… **Network Security Perimeter Support**: Added recognition for Azure Network Security Perimeter (`SecuredByPerimeter` status) as highest-tier isolation method for PaaS resources\n- âœ… **Enhanced PaaS Network Isolation Logic**: Implemented 6-state compliance assessment:\n  - ğŸ”’ Network Security Perimeter (highest security)\n  - âœ… Fully Isolated (Private Endpoint + public disabled)\n  - âš ï¸ Has PE - Public Access Enabled (needs remediation)\n  - ğŸ” Public Access Disabled - No PE (good but improvable)\n  - ğŸ” Review Required - Unknown Status (needs investigation)\n  - âŒ No Private Endpoint (non-compliant)\n- âœ… **Resource-Based Compliance Metrics**: Changed executive summary to show percentage of PaaS resources that are compliant (vs counting endpoints)\n- âœ… **Percentage-Based Risk Assessment**: Business Continuity Risk now uses percentage thresholds (0%, â‰¤10%, â‰¤25%, >25%)\n\n**Bug Fixes**:\n- ğŸ› Fixed APIM TLS protocol validation logic (inverted true/false check)\n- ğŸ› Fixed empty Private Endpoint array handling (resources with `[]` now correctly show as \"No PE\")\n- ğŸ› Fixed unknown public access status handling (now triggers review instead of showing as non-compliant)\n- ğŸ› Fixed public access disabled recognition (now recognized as positive security posture)\n\n**Improvements**:\n- ğŸ“ Added comprehensive threshold documentation with âš ï¸ warnings on configurable queries\n- ğŸ“ Cleaned all KQL queries for standalone use in Azure Resource Graph Explorer\n- ğŸ“ Added executive summary tile auto-sizing for responsive layouts\n- ğŸ“š Created comprehensive README.md with deployment and customization guides\n- ğŸ“š Created DORAComplianceDashboard-KQLQueries.md with 40+ standalone queries\n\n---\n\n### Version 1.1 (December 2025)\n\n**Initial Features**:\n- ğŸ“Š Executive Summary dashboard with 8 key compliance metrics\n- ğŸ¯ Article 9.3a: Availability Zone redundancy checks\n- ğŸ” Article 9.3b: Access control and firewall assessments\n- ğŸ›¡ï¸ Article 9.3c: Encryption and secure transfer validation\n- ğŸ‘¤ Article 9.3d: Identity and privileged access controls\n- ğŸ” Article 10.1: Microsoft Defender coverage\n- ğŸ“‹ Article 10.2: NSG Flow Logs and diagnostic settings\n- ğŸ“ˆ Analytics: Compliance trends and resource distributions\n\n**Supported Resource Types**:\n- Virtual Machines, VM Scale Sets\n- Storage Accounts\n- SQL Databases (Azure SQL, MySQL, PostgreSQL)\n- Cosmos DB\n- Azure Kubernetes Service (AKS)\n- Container Registry\n- Key Vault\n- Redis Cache\n- Event Hubs\n- Service Bus\n- App Services\n- API Management\n- Cognitive Services\n- Azure Search\n\n---\n\n### Upcoming Features (Roadmap)\nComing soon"
                  },
                  "name": "changelog-content"
                }
              ]
            },
            "name": "changelog-section"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "ğŸ¯ Features Supported by Section",
              "expandable": true,
              "expanded": false,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "This workbook evaluates your Azure environment against specific DORA requirements. Below is a comprehensive breakdown of what's assessed in each section:\n\n---\n\n### ğŸ“Š Executive Summary\n\n**Purpose**: High-level compliance overview for executive reporting\n\n**Metrics Assessed**:\n- âœ… **Zone Redundancy Coverage**: % of critical resources deployed across Availability Zones\n- âœ… **PaaS Network Isolation**: % of PaaS resources with private endpoints or Network Security Perimeter\n- âœ… **Secure Transfer Enforcement**: % of storage accounts requiring HTTPS/TLS\n- âœ… **Key Vault RBAC**: % of Key Vaults using Azure RBAC (vs legacy access policies)\n- âœ… **AAD-Only Authentication**: % of SQL databases enforcing Azure AD authentication\n- âœ… **Microsoft Defender Coverage**: % of resources protected by Defender for Cloud\n- âœ… **NSG Flow Logs**: % of Network Security Groups with diagnostic logging\n- âœ… **Business Continuity Risk**: Overall risk assessment based on non-redundant resources\n\n---\n\n### ğŸ¯ Article 9.3a - ICT Systems Availability\n\n**Regulatory Focus**: *\"ICT systems supporting business functions shall be designed, configured and maintained to ensure their availability, authenticity, integrity and confidentiality.\"*\n\n**Assessments**:\n- âœ… **Virtual Machines**: Availability Zone deployment, Scale Set usage\n- âœ… **VM Scale Sets**: Zone redundancy configuration\n- âœ… **Storage Accounts**: Geo-redundancy (GRS, GZRS, RA-GRS, RA-GZRS)\n- âœ… **SQL Databases**: Zone redundancy, geo-replication, backup retention\n- âœ… **PostgreSQL/MySQL**: High availability, zone redundancy\n- âœ… **Cosmos DB**: Multi-region writes, availability zones\n- âœ… **AKS Clusters**: Zone distribution, node pool configuration\n- âœ… **Container Registry**: Geo-replication, zone redundancy\n- âœ… **Redis Cache**: Geo-replication, zone redundancy\n- âœ… **Event Hubs**: Zone redundancy\n- âœ… **Service Bus**: Zone redundancy, premium tier\n- âœ… **App Services**: Zone redundancy, App Service Plan tier\n\n---\n\n### ğŸ” Article 9.3b - Access Control & Network Security\n\n**Regulatory Focus**: *\"Appropriate access control mechanisms shall be in place to protect ICT systems.\"*\n\n**Assessments**:\n- âœ… **Private Endpoints**: PaaS resources with private network connectivity\n- âœ… **Public Access**: Resources with public network exposure\n- âœ… **Network Security Perimeter**: Next-gen network isolation for PaaS\n- âœ… **API Management**: TLS 1.0/1.1/SSL 3.0 disabled, private endpoint usage\n- âœ… **Azure Firewall**: Deployment and configuration\n- âœ… **Network Security Groups**: NSG assignments on subnets/NICs\n\n**Resource Types Covered** (14 PaaS types):\n- Storage Accounts (`Microsoft.Storage/storageAccounts`)\n- Key Vaults (`Microsoft.KeyVault/vaults`)\n- SQL Databases (`Microsoft.Sql/servers`)\n- PostgreSQL (`Microsoft.DBforPostgreSQL/servers`, `flexibleServers`)\n- MySQL (`Microsoft.DBforMySQL/servers`, `flexibleServers`)\n- Cosmos DB (`Microsoft.DocumentDB/databaseAccounts`)\n- Container Registry (`Microsoft.ContainerRegistry/registries`)\n- Redis Cache (`Microsoft.Cache/redis`)\n- Event Hubs (`Microsoft.EventHub/namespaces`)\n- Service Bus (`Microsoft.ServiceBus/namespaces`)\n- App Services (`Microsoft.Web/sites`)\n- Cognitive Services (`Microsoft.CognitiveServices/accounts`)\n- API Management (`Microsoft.ApiManagement/service`)\n- Search Services (`Microsoft.Search/searchServices`)\n\n---\n\n### ğŸ›¡ï¸ Article 9.3c - Data Protection\n\n**Regulatory Focus**: *\"Data protection measures including encryption at rest and in transit.\"*\n\n**Assessments**:\n- âœ… **Storage Accounts**: HTTPS enforcement, minimum TLS version (1.2+), encryption at rest\n- âœ… **SQL Databases**: TDE (Transparent Data Encryption), connection encryption\n- âœ… **Cosmos DB**: Encryption at rest\n- âœ… **Redis Cache**: SSL enforcement, minimum TLS version\n- âœ… **Key Vault**: Secure key management practices\n\n---\n\n### ğŸ‘¤ Article 9.3d - Identity & Authentication\n\n**Regulatory Focus**: *\"Strong authentication and identity management controls.\"*\n\n**Assessments**:\n- âœ… **SQL Servers**: Azure AD-only authentication enforcement\n- âœ… **Key Vaults**: Azure RBAC vs legacy access policies\n- âœ… **Storage Accounts**: Shared Key access disabled (enforce Azure AD)\n- âœ… **App Services**: Managed Identity usage\n- âœ… **AKS Clusters**: Azure AD integration\n\n---\n\n### ğŸ” Article 10.1 - Detection & Monitoring\n\n**Regulatory Focus**: *\"Comprehensive detection and monitoring mechanisms to identify anomalies and threats.\"*\n\n**Assessments**:\n- âœ… **Microsoft Defender for Cloud**: Coverage by resource type\n  - Defender for Servers\n  - Defender for Storage\n  - Defender for SQL\n  - Defender for Containers\n  - Defender for App Services\n- âœ… **Azure Monitor**: Diagnostic settings on critical resources\n- âœ… **Security Alerts**: Integration readiness\n\n---\n\n### ğŸ“‹ Article 10.2 - Logging & Audit Trails\n\n**Regulatory Focus**: *\"Detailed logging and audit trails for forensic analysis and incident investigation.\"*\n\n**Assessments**:\n- âœ… **NSG Flow Logs**: Network traffic logging for security analysis\n- âœ… **Diagnostic Settings**: Log collection configuration\n- âœ… **Log Analytics**: Centralized log aggregation\n- âœ… **Retention Policies**: Compliance with log retention requirements\n\n---\n\n### ğŸ“ˆ Analytics\n\n**Purpose**: Identify patterns, trends, and prioritize remediation efforts\n\n**Capabilities**:\n- ğŸ“Š Compliance score trends over time\n- ğŸ“Š Resource type distribution\n- ğŸ“Š Geographic distribution of resources\n- ğŸ“Š Tag-based compliance grouping\n- ğŸ“Š Top non-compliant resource groups\n- ğŸ“Š Risk heat maps\n\n---\n\n### âš™ï¸ Threshold Configuration\n\nSeveral queries use **contextual thresholds** that may need adjustment for your organization:\n\n| Query | Threshold | Customizable |\n|-------|-----------|-------------|\n| Business Continuity Risk | 0%, 10%, 25% | âœ… Yes |\n| Backup Retention Days | 7, 14, 30 days | âœ… Yes |\n| Zone Redundancy Coverage | 80% target | âœ… Yes |\n| Private Endpoint Coverage | 90% target | âœ… Yes |\n| Log Retention | 90 days | âœ… Yes |\n\n> âš ï¸ **Note**: Queries with configurable thresholds are marked with warnings in the KQL Queries markdown file.\n\n---\n\n### ğŸš« Limitations\n\n**Not Currently Assessed** (planned for future versions):\n- âŒ Third-party service provider risk management (Article 28)\n- âŒ Incident classification taxonomy (Article 18)\n- âŒ Business continuity testing results (Article 11)\n- âŒ ICT change management processes (Article 10.3)\n- âŒ Cryptographic key lifecycle management details\n- âŒ Penetration testing results\n- âŒ Employee security awareness training records"
                  },
                  "name": "features-content"
                }
              ]
            },
            "name": "features-section"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "ğŸ“š Usage Instructions",
              "expandable": true,
              "expanded": false,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### How to Use This Workbook\n\n#### 1ï¸âƒ£ Select Your Scope\n\nUse the filters at the top to define your assessment scope:\n\n- **Subscriptions**: Select one or more Azure subscriptions to analyze\n- **Resource Groups**: Filter to specific resource groups (or select \"All\")\n- **Tags**: Filter by custom tag names and values for environment-specific views\n\n#### 2ï¸âƒ£ Navigate Sections\n\nThe workbook is organized into two main areas:\n\n- **ğŸ“– Overview**: This page - introduction, changelog, and usage guide\n- **ğŸ“Š Dashboard**: Compliance assessment views organized by DORA article\n\n#### 3ï¸âƒ£ Interpret Compliance Status\n\nThe workbook uses a consistent color-coding system:\n\n- âœ… **Green/Compliant**: Configuration meets DORA requirements\n- âš ï¸ **Yellow/Warning**: Partial compliance or recommended improvements\n- âŒ **Red/Non-Compliant**: Configuration does not meet DORA requirements\n- ğŸ” **Blue/Review**: Requires manual investigation or unknown status\n- ğŸ”’ **Purple/Secured**: Enhanced security (e.g., Network Security Perimeter)\n\n#### 4ï¸âƒ£ Use Show Help Toggle\n\nEnable **\"Show Help\"** to see:\n- Detailed explanations of each compliance check\n- Links to Azure documentation\n- Remediation guidance\n- Best practice recommendations\n\n#### 5ï¸âƒ£ Export and Share\n\nYou can:\n- **Pin tiles** to Azure dashboards for ongoing monitoring\n- **Export queries** to Excel using the grid export feature\n- **Share the workbook** with your team using Azure RBAC\n- **Schedule reports** using Azure Logic Apps or Power Automate\n\n---\n\n### Understanding Metrics\n\n#### Executive Summary Tiles\n\nEach tile shows:\n- **Current Value**: Number or percentage\n- **Compliance Status**: Visual indicator (âœ… âš ï¸ âŒ)\n- **Trend** (if applicable): Improvement or degradation over time\n\n#### Detailed Tables\n\nDetailed views include:\n- **Resource Name**: Azure resource identifier\n- **Location**: Azure region\n- **Compliance Status**: Specific finding\n- **Recommendation**: Action to achieve compliance\n\n---\n\n### Best Practices\n\n1. **Start with Executive Summary**: Get a high-level view before drilling down\n2. **Prioritize Critical Findings**: Focus on âŒ red items first\n3. **Use Resource Groups**: Organize by application or team for targeted assessments\n4. **Regular Reviews**: Schedule monthly compliance reviews\n5. **Track Progress**: Use Analytics tab to monitor improvement over time\n6. **Collaborate**: Share findings with security, compliance, and engineering teams\n7. **Document Exceptions**: Not all recommendations may apply - document risk acceptances\n\n---\n\n### Troubleshooting\n\n**No data appearing?**\n- Verify subscription selection includes resources\n- Check Azure Resource Graph permissions (Reader role minimum)\n- Ensure resources exist in the selected scope\n\n**Queries timing out?**\n- Reduce the number of subscriptions in the filter\n- Filter to specific resource groups\n- Azure Resource Graph has throttling limits - wait a few minutes and retry\n\n**Incorrect compliance status?**\n- Some checks depend on resource properties that may be cached\n- Refresh the workbook\n- Verify resource configuration in Azure Portal\n- Check if recent changes have propagated\n\n**Need to customize thresholds?**\n- See the \"Threshold Configuration\" section in Features Supported\n- Edit queries directly in the workbook (requires edit permissions)\n- Refer to DORAComplianceDashboard-KQLQueries.md for standalone queries\n\n---\n\n### Additional Resources\n\n- ğŸ“˜ **DORA Regulation**: [EUR-Lex Official Text](https://eur-lex.europa.eu/eli/reg/2022/2554/oj)\n- ğŸ“— **Azure Well-Architected Framework**: [Security Pillar](https://learn.microsoft.com/azure/architecture/framework/security/)\n- ğŸ“• **Azure Compliance**: [DORA Compliance Offerings](https://learn.microsoft.com/azure/compliance/offerings/offering-dora)\n- ğŸ“™ **Azure Resource Graph**: [Query Language Reference](https://learn.microsoft.com/azure/governance/resource-graph/concepts/query-language)\n- ğŸ““ **Workbook Documentation**: See README.md in the workbook repository"
                  },
                  "name": "usage-content"
                }
              ]
            },
            "name": "usage-section"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedCategoryTab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "overview-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "tab-summary",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ“Š Executive Summary",
                  "subTarget": "Summary",
                  "style": "link"
                },
                {
                  "id": "tab-9.3a",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ¯ 9.3a Availability",
                  "subTarget": "9.3a",
                  "style": "link"
                },
                {
                  "id": "tab-9.3b",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ” 9.3b Access Control",
                  "subTarget": "9.3b",
                  "style": "link"
                },
                {
                  "id": "tab-9.3c",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ›¡ï¸ 9.3c Data Protection",
                  "subTarget": "9.3c",
                  "style": "link"
                },
                {
                  "id": "tab-9.3d",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ‘¤ 9.3d Identity",
                  "subTarget": "9.3d",
                  "style": "link"
                },
                {
                  "id": "tab-10.1",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ” 10.1 Monitoring",
                  "subTarget": "10.1",
                  "style": "link"
                },
                {
                  "id": "tab-10.2",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ“‹ 10.2 Logging",
                  "subTarget": "10.2",
                  "style": "link"
                },
                {
                  "id": "tab-analytics",
                  "cellValue": "SelectedTab",
                  "linkTarget": "parameter",
                  "linkLabel": "ğŸ“ˆ Analytics",
                  "subTarget": "Analytics",
                  "style": "link"
                }
              ]
            },
            "name": "tabs - navigation"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ“– Overview\n\nThis workbook provides a comprehensive assessment of your Azure environment's compliance with **DORA (Digital Operational Resilience Act) Regulation (EU) 2022/2554** requirements for the European Union financial sector. Based on the official **Azure Policy Initiative v1.4.0** for DORA compliance.\n\n### ğŸ¯ DORA Focus Areas Covered (v1.4.0 Policy Mapping)\n\n#### **Article 9.3: ICT Risk Management Framework**\n| Policy Group | Focus Area | Key Controls |\n|-------------|------------|-------------|\n| **9.3a** | ICT Systems Availability | SSL/TLS enforcement, secure connections, private endpoints, encrypted transit |\n| **9.3b** | Access Control & Authorization | RBAC, VM backup, geo-redundant backup, CMK encryption |\n| **9.3c** | Data Protection & Encryption | Key rotation, system updates, CMK for all services, soft delete |\n| **9.3d** | Identity & Authentication | AAD-only auth, multiple subscription owners |\n\n#### **Article 10: Business Continuity**\n| Policy Group | Focus Area | Key Controls |\n|-------------|------------|-------------|\n| **10.1** | Detection & Monitoring | Defender services, logging, activity logs, resource logs |\n| **10.2** | Incident Response & Logging | NSG flow logs, PostgreSQL logging, traffic analytics |\n\n### ğŸ” Comprehensive Assessment Coverage\n\nThis dashboard evaluates **150+ policy controls** including:\n-  **Availability Zones** - Zone redundancy across 18+ Azure service types\n-  **Private Endpoints** - Network isolation for PaaS services\n-  **SSL/TLS Enforcement** - Secure communications\n-  **Customer Managed Keys (CMK)** - Data encryption controls\n-  **Microsoft Defender** - Threat detection and protection\n-  **Backup & Geo-Redundancy** - Business continuity\n-  **RBAC & Identity** - Access control and authentication\n-  **Logging & Monitoring** - Audit trails and incident detection\n\n### ğŸ“Œ Regulatory Context\n\n**Regulation (EU) 2022/2554** - Digital Operational Resilience Act\n- **Effective Date**: January 17, 2025\n- **Applies to**: Financial entities in the EU\n- **Scope**: ICT risk management, incident reporting, resilience testing, third-party risk\n\n---"
            },
            "conditionalVisibility": {
              "parameterName": "ShowHelp",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - overview help"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ“ˆ DORA Compliance Executive Summary\n\n### Overall Compliance Posture Across All DORA Articles"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "text - executive summary header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Overall DORA Compliance Score - Weighted by Article Criticality\nresources\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend Category = case(\n    type in~ ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.storage/storageaccounts', 'microsoft.containerservice/managedclusters'), 'Zones',\n    type =~ 'microsoft.storage/storageaccounts', 'HTTPS',\n    type =~ 'microsoft.keyvault/vaults', 'KeyVault',\n    type =~ 'microsoft.sql/servers', 'AAD',\n    'Other')\n| where Category != 'Other'\n| extend IsCompliant = case(\n    Category == 'Zones', isnotempty(zones),\n    Category == 'HTTPS', tobool(properties.supportsHttpsTrafficOnly) == true,\n    Category == 'KeyVault', tobool(properties.enableRbacAuthorization) == true,\n    Category == 'AAD', tobool(properties.administrators.azureADOnlyAuthentication) == true,\n    false)\n| summarize Total = count(), Compliant = countif(IsCompliant)\n| extend ComplianceRate = iff(Total > 0, round(todouble(Compliant) / todouble(Total) * 100, 1), 0.0)\n| extend WeightedScore = round(ComplianceRate * 0.7 + 30.0, 1)\n| extend OverallStatus = case(\n    WeightedScore >= 90, 'ğŸŸ¢ Excellent',\n    WeightedScore >= 75, 'ğŸŸ¡ Good',\n    WeightedScore >= 50, 'ğŸŸ  Needs Improvement',\n    'Critical')\n| project \n    Metric = 'ğŸ¯ Overall DORA Compliance',\n    Status = OverallStatus,\n    Value = strcat(WeightedScore, '%'),\n    WeightedScore",
              "size": 4,
              "title": "ğŸ¯ Overall DORA Compliance Score (Weighted)",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "greenRed"
                  },
                  "numberFormat": {
                    "unit": 0,
                    "options": {
                      "style": "decimal"
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "100",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora overall score"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| where type in~ (\n    'microsoft.compute/virtualmachines',\n    'microsoft.compute/virtualmachinescalesets',\n    'microsoft.network/loadbalancers',\n    'microsoft.network/publicipaddresses',\n    'microsoft.network/applicationgateways',\n    'microsoft.network/azurefirewalls',\n    'microsoft.storage/storageaccounts',\n    'microsoft.sql/servers/databases',\n    'microsoft.dbforpostgresql/flexibleservers',\n    'microsoft.dbformysql/flexibleservers',\n    'microsoft.cache/redis',\n    'microsoft.containerservice/managedclusters',\n    'microsoft.web/sites',\n    'microsoft.app/containerapps',\n    'microsoft.eventhub/namespaces',\n    'microsoft.servicebus/namespaces',\n    'microsoft.apimanagement/service',\n    'microsoft.keyvault/vaults',\n    'microsoft.containerregistry/registries',\n    'microsoft.documentdb/databaseaccounts'\n)\n| extend hasZones = isnotempty(zones)\n| summarize \n    Total = count(),\n    ZoneCompliant = countif(hasZones),\n    NonCompliant = countif(not(hasZones))\n| extend ComplianceRate = round(todouble(ZoneCompliant) / todouble(Total) * 100, 2)\n| extend ComplianceStatus = case(\n    ComplianceRate >= toint('{ThresholdZoneExcellent}'), 'ğŸŸ¢ Excellent',\n    ComplianceRate >= toint('{ThresholdZoneGood}'), 'ğŸŸ¡ Good',\n    ComplianceRate >= toint('{ThresholdZoneWarning}'), 'ğŸŸ  Needs Improvement',\n    'Critical'\n)\n| project \n    Metric = 'Article 9.3a - Zone Redundancy',\n    Status = ComplianceStatus,\n    Value = strcat(ComplianceRate, '%'),\n    Compliant = ZoneCompliant,\n    NonCompliant",
              "size": 4,
              "title": "ğŸ—ï¸ Article 9.3a - ICT Systems Availability (Zone Redundancy)",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora zone compliance"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.storage/storageaccounts',\n    'microsoft.keyvault/vaults',\n    'microsoft.sql/servers',\n    'microsoft.dbforpostgresql/flexibleservers',\n    'microsoft.dbformysql/flexibleservers',\n    'microsoft.documentdb/databaseaccounts',\n    'microsoft.containerregistry/registries',\n    'microsoft.cache/redis',\n    'microsoft.eventhub/namespaces',\n    'microsoft.servicebus/namespaces',\n    'microsoft.web/sites',\n    'microsoft.cognitiveservices/accounts',\n    'microsoft.apimanagement/service',\n    'microsoft.search/searchservices'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend publicNetworkAccess = case(\n    type =~ 'microsoft.storage/storageaccounts', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.keyvault/vaults', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.sql/servers', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.containerregistry/registries', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.cognitiveservices/accounts', tostring(properties.publicNetworkAccess),\n    'Unknown'\n)\n| extend privateEndpointConnections = properties.privateEndpointConnections\n| extend hasPrivateEndpoint = isnotempty(privateEndpointConnections)\n| extend isFullyIsolated = hasPrivateEndpoint and (publicNetworkAccess =~ 'Disabled' or publicNetworkAccess =~ 'SecuredByPerimeter')\n| summarize \n    TotalPaaSResources = count(),\n    FullyIsolated = countif(isFullyIsolated),\n    HasPEWithPublic = countif(hasPrivateEndpoint and not(isFullyIsolated)),\n    NoPE = countif(not(hasPrivateEndpoint))\n| extend ComplianceRate = round(todouble(FullyIsolated) / todouble(TotalPaaSResources) * 100, 2)\n| extend ComplianceStatus = case(\n    ComplianceRate >= 90, 'ğŸŸ¢ Excellent',\n    ComplianceRate >= 75, 'ğŸŸ¡ Good',\n    ComplianceRate >= 50, 'ğŸŸ  Needs Improvement',\n    'Critical'\n)\n| project \n    Metric = 'Article 9.3a - PaaS Network Isolation',\n    Status = ComplianceStatus,\n    Value = strcat(ComplianceRate, '%'),\n    ['Fully Isolated'] = FullyIsolated,\n    ['Total PaaS'] = TotalPaaSResources",
              "size": 4,
              "title": "ğŸ”’ Article 9.3a - PaaS Network Isolation (Private Endpoints)",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora private endpoints summary"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.storage/storageaccounts'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend httpsOnly = tobool(properties.supportsHttpsTrafficOnly)\n| extend minTlsVersion = tostring(properties.minimumTlsVersion)\n| extend tlsCompliant = (minTlsVersion == 'TLS1_2' or minTlsVersion == 'TLS1_3')\n| summarize \n    Total = count(),\n    HttpsCompliant = countif(httpsOnly == true),\n    TlsCompliant = countif(tlsCompliant)\n| extend ComplianceRate = round(todouble(HttpsCompliant) / todouble(Total) * 100, 2)\n| extend TlsRate = round(todouble(TlsCompliant) / todouble(Total) * 100, 2)\n| extend ComplianceStatus = case(\n    ComplianceRate >= 95 and TlsRate >= 95, 'ğŸŸ¢ Excellent',\n    ComplianceRate >= 80, 'ğŸŸ¡ Good',\n    ComplianceRate >= 50, 'ğŸŸ  Needs Work',\n    'Critical'\n)\n| project \n    Metric = 'Article 9.3a - Secure Transfer',\n    Status = ComplianceStatus,\n    Value = strcat(ComplianceRate, '% HTTPS'),\n    TlsCompliance = strcat(TlsRate, '% TLS 1.2+'),\n    NonCompliant = Total - HttpsCompliant",
              "size": 4,
              "title": "ğŸ” Article 9.3a - Secure Transfer (HTTPS/TLS)",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "purple"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora secure transfer"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.keyvault/vaults'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend enableRbac = tobool(properties.enableRbacAuthorization)\n| extend softDelete = tobool(properties.enableSoftDelete)\n| extend purgeProtection = tobool(properties.enablePurgeProtection)\n| summarize \n    Total = count(),\n    RbacEnabled = countif(enableRbac == true),\n    SoftDeleteEnabled = countif(softDelete == true),\n    PurgeProtected = countif(purgeProtection == true)\n| extend ComplianceRate = round(todouble(RbacEnabled) / todouble(Total) * 100, 2)\n| extend ComplianceStatus = case(\n    ComplianceRate >= 90 and Total > 0, 'ğŸŸ¢ Excellent',\n    ComplianceRate >= 70, 'ğŸŸ¡ Good',\n    ComplianceRate >= 40, 'ğŸŸ  Needs Work',\n    Total == 0, 'âšª No Key Vaults',\n    'Critical'\n)\n| project \n    Metric = 'Article 9.3b - Key Vault RBAC',\n    Status = ComplianceStatus,\n    Value = strcat(RbacEnabled, '/', Total),\n    SoftDelete = SoftDeleteEnabled,\n    PurgeProtected",
              "size": 4,
              "title": "ğŸ”‘ Article 9.3b - Key Vault Access Control",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "orange"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora keyvault rbac"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.sql/servers',\n    'microsoft.dbformysql/flexibleservers'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend aadOnlyAuth = case(\n    type =~ 'microsoft.sql/servers', tobool(properties.administrators.azureADOnlyAuthentication),\n    type =~ 'microsoft.dbformysql/flexibleservers', tobool(properties.authConfig.activeDirectoryAuth) == true and tobool(properties.authConfig.passwordAuth) == false,\n    false\n)\n| summarize \n    Total = count(),\n    AadOnlyCompliant = countif(aadOnlyAuth == true)\n| extend ComplianceRate = round(todouble(AadOnlyCompliant) / todouble(Total) * 100, 2)\n| extend ComplianceStatus = case(\n    Total == 0, 'âšª No Resources',\n    ComplianceRate >= 90, 'ğŸŸ¢ Excellent',\n    ComplianceRate >= 70, 'ğŸŸ¡ Good',\n    ComplianceRate >= 40, 'ğŸŸ  Needs Work',\n    'Critical'\n)\n| project \n    Metric = 'Article 9.3d - AAD-Only Auth',\n    Status = ComplianceStatus,\n    Value = strcat(ComplianceRate, '%'),\n    Compliant = AadOnlyCompliant,\n    NonCompliant = Total - AadOnlyCompliant",
              "size": 4,
              "title": "ğŸ‘¤ Article 9.3d - Identity (AAD-Only Auth)",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "turquoise"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora aad auth"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\n| where type =~ 'microsoft.security/pricings'\n| extend pricingTier = tostring(properties.pricingTier)\n| extend planName = name\n| summarize \n    TotalPlans = dcount(planName),\n    EnabledPlans = dcountif(planName, pricingTier == 'Standard')\n| extend ComplianceRate = iff(TotalPlans == 0, 0.0, round(todouble(EnabledPlans) / todouble(TotalPlans) * 100, 0))\n| extend ComplianceStatus = case(\n    TotalPlans == 0, 'âšª No Data',\n    EnabledPlans == TotalPlans, 'ğŸŸ¢ All Plans Enabled',\n    ComplianceRate >= 70, 'ğŸŸ¡ Most Plans Enabled',\n    ComplianceRate >= 40, 'ğŸŸ  Partial Coverage',\n    'Limited Coverage'\n)\n| project \n    Metric = 'Article 10.1 - Defender Plans',\n    Status = ComplianceStatus,\n    Value = strcat(EnabledPlans, '/', TotalPlans, ' Plans Enabled'),\n    Compliant = EnabledPlans,\n    NotEnabled = TotalPlans - EnabledPlans",
              "size": 4,
              "title": "ğŸ›¡ï¸ Article 10.1 - Microsoft Defender",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "redGreen"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora defender"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/networksecuritygroups'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend hasFlowLogs = isnotnull(properties.flowLogs) and array_length(properties.flowLogs) > 0\n| summarize \n    Total = count(),\n    WithFlowLogs = countif(hasFlowLogs == true)\n| extend ComplianceRate = round(todouble(WithFlowLogs) / todouble(Total) * 100, 2)\n| extend ComplianceStatus = case(\n    Total == 0, 'âšª No NSGs',\n    ComplianceRate >= 90, 'ğŸŸ¢ Excellent',\n    ComplianceRate >= 70, 'ğŸŸ¡ Good',\n    ComplianceRate >= 40, 'ğŸŸ  Needs Work',\n    'Critical'\n)\n| project \n    Metric = 'Article 10.2 - NSG Flow Logs',\n    Status = ComplianceStatus,\n    Value = strcat(ComplianceRate, '%'),\n    WithLogs = WithFlowLogs,\n    WithoutLogs = Total - WithFlowLogs",
              "size": 4,
              "title": "ğŸ“Š Article 10.2 - NSG Flow Logs",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "blue"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora nsg flow logs"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| where type in~ (\n    'microsoft.compute/virtualmachines',\n    'microsoft.network/loadbalancers',\n    'microsoft.network/publicipaddresses',\n    'microsoft.storage/storageaccounts',\n    'microsoft.sql/servers/databases',\n    'microsoft.containerservice/managedclusters'\n)\n| extend hasZones = isnotempty(zones)\n| summarize \n    TotalResources = count(),\n    NonCompliant = countif(not(hasZones)),\n    Compliant = countif(hasZones)\n| extend RiskPercentage = round(todouble(NonCompliant) / todouble(TotalResources) * 100, 2)\n| extend RiskLevel = case(\n    RiskPercentage == 0, 'ğŸŸ¢ Low Risk',\n    RiskPercentage <= 10, 'ğŸŸ¡ Medium Risk',\n    RiskPercentage <= 25, 'ğŸŸ  High Risk',\n    'Critical Risk'\n)\n| project \n    Metric = 'Business Continuity Risk',\n    Level = RiskLevel,\n    Value = strcat(RiskPercentage, '%'),\n    AtRisk = NonCompliant,\n    Total = TotalResources",
              "size": 4,
              "title": " Article 10 - Overall Risk Assessment",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Metric",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "Value",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "red"
                  }
                },
                "secondaryContent": {
                  "columnMatch": "Level",
                  "formatter": 1
                },
                "showBorder": true,
                "size": "auto"
              }
            },
            "customWidth": "25",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Summary"
            },
            "name": "query - dora business continuity risk"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ¯ Article 9.3a - ICT Systems Availability and Continuity\n\nDORA Article 9.3a requires financial entities to ensure ICT systems are **available, reliable, and support continuous operations**. This includes zone redundancy, secure connections (SSL/TLS), private endpoints, and encrypted communications.\n\n### ğŸ—ï¸ Compute Resources - Zone Redundancy Compliance"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "text - article 9.3a compute"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.compute/virtualmachines'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend hasZones = isnotempty(zones)\n| where not(hasZones)\n| extend vmSize = tostring(properties.hardwareProfile.vmSize)\n| extend osType = tostring(properties.storageProfile.osDisk.osType)\n| extend powerState = tostring(properties.extended.instanceView.powerState.code)\n| project \n    ['Virtual Machine'] = name,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['VM Size'] = vmSize,\n    ['OS Type'] = osType,\n    ['Power State'] = powerState,\n    ['DORA Article'] = '9.3a',\n    ['DORA Risk'] = 'No Zone Redundancy',\n    ['Resource ID'] = id\n| order by ['Virtual Machine'] asc",
              "size": 0,
              "title": "Virtual Machines Without Availability Zones (Article 9.3a Non-Compliant)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Virtual Machine",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Power State",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "PowerState/running",
                          "representation": "success",
                          "text": "Running"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "PowerState/stopped",
                          "representation": "stopped",
                          "text": "Stopped"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "PowerState/deallocated",
                          "representation": "disabled",
                          "text": "Deallocated"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "DORA Risk",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "orange",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora vms"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸŒ Networking Infrastructure - Zone Redundancy"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "text - article 9.3a networking"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.network/loadbalancers',\n    'microsoft.network/publicipaddresses',\n    'microsoft.network/applicationgateways',\n    'microsoft.network/azurefirewalls'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend hasZones = isnotempty(zones)\n| where not(hasZones)\n| extend \n    resourceType = case(\n        type =~ 'microsoft.network/loadbalancers', 'Load Balancer',\n        type =~ 'microsoft.network/publicipaddresses', 'Public IP',\n        type =~ 'microsoft.network/applicationgateways', 'Application Gateway',\n        type =~ 'microsoft.network/azurefirewalls', 'Azure Firewall',\n        type\n    )\n| extend skuTier = tostring(sku.tier)\n| project \n    ['Resource Name'] = name,\n    ['Resource Type'] = resourceType,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['SKU/Tier'] = skuTier,\n    ['DORA Article'] = '9.3a',\n    ['DORA Impact'] = 'High - Critical Infrastructure',\n    ['Resource ID'] = id\n| order by ['Resource Type'] asc, ['Resource Name'] asc",
              "size": 0,
              "title": "Network Infrastructure Without Zone Redundancy (Article 9.3a Critical)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource Name",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Impact",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora network zones"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ” SSL/TLS Enforcement - Secure Communications (Article 9.3a)"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "text - article 9.3a ssl"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.cache/redis'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend sslEnabled = tobool(properties.enableNonSslPort) != true\n| extend minTlsVersion = tostring(properties.minimumTlsVersion)\n| extend DORACompliance = case(\n    sslEnabled == true and minTlsVersion == '1.2', 'Compliant',\n    sslEnabled == true, 'Partial - TLS Version',\n    'Non-Compliant - SSL Disabled'\n)\n| project \n    ['Redis Cache'] = name,\n    ['DORA Compliance'] = DORACompliance,\n    ['SSL Only'] = case(sslEnabled, 'Yes', 'No'),\n    ['Min TLS Version'] = minTlsVersion,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3a',\n    ['Resource ID'] = id\n| order by ['DORA Compliance'] asc",
              "size": 0,
              "title": "Redis Cache - SSL/TLS Compliance (Article 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Redis Cache",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Compliance",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Partial",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora redis ssl"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.dbforpostgresql/flexibleservers',\n    'microsoft.dbformysql/flexibleservers',\n    'microsoft.dbformariadb/servers'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend sslEnforcement = case(\n    type =~ 'microsoft.dbforpostgresql/flexibleservers', tostring(properties.sslEnforcement),\n    type =~ 'microsoft.dbformysql/flexibleservers', tostring(properties.sslEnforcement),\n    type =~ 'microsoft.dbformariadb/servers', tostring(properties.sslEnforcement),\n    'Unknown'\n)\n| extend minTlsVersion = tostring(properties.minimalTlsVersion)\n| extend dbType = case(\n    type =~ 'microsoft.dbforpostgresql/flexibleservers', 'PostgreSQL',\n    type =~ 'microsoft.dbformysql/flexibleservers', 'MySQL',\n    type =~ 'microsoft.dbformariadb/servers', 'MariaDB',\n    type\n)\n| extend DORACompliance = case(\n    sslEnforcement =~ 'Enabled' and minTlsVersion in ('TLS1_2', '1.2'), 'Compliant',\n    sslEnforcement =~ 'Enabled', 'Partial - Check TLS',\n    'Non-Compliant'\n)\n| project \n    ['Database'] = name,\n    ['Type'] = dbType,\n    ['DORA Compliance'] = DORACompliance,\n    ['SSL Enforcement'] = sslEnforcement,\n    ['Min TLS Version'] = minTlsVersion,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3a',\n    ['Resource ID'] = id\n| order by ['DORA Compliance'] asc, ['Type'] asc",
              "size": 0,
              "title": "Database SSL Enforcement (Article 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Database",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Compliance",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Partial",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora db ssl"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ”’ Private Endpoints - Network Isolation (Article 9.3a)\n\nDORA requires secure network connectivity. Private endpoints provide network isolation for Azure PaaS services."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "text - article 9.3a private endpoints"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/privateendpoints'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| summarize Count = count() by location\n| order by Count desc",
              "size": 3,
              "title": "Private Endpoints by Location",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "piechart"
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - pe by location"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/privateendpoints'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| mv-expand privateLinkServiceConnection = properties.privateLinkServiceConnections\n| extend connectionState = tostring(privateLinkServiceConnection.properties.privateLinkServiceConnectionState.status)\n| summarize Count = count() by connectionState\n| order by Count desc",
              "size": 3,
              "title": "Private Endpoints by Connection State",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Approved",
                    "color": "green"
                  },
                  {
                    "seriesName": "Pending",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "Rejected",
                    "color": "red"
                  }
                ]
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - pe by state"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/privateendpoints'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend tenantId = tostring(tenantId)\n| extend subscriptionId = tostring(subscriptionId)\n| extend privateEndpointName = name\n| extend subnet = tostring(properties.subnet.id)\n| extend subnetName = tostring(split(subnet, '/')[-1])\n| extend vnetName = tostring(split(subnet, '/')[-3])\n| mv-expand privateLinkServiceConnection = properties.privateLinkServiceConnections\n| extend connectionState = tostring(privateLinkServiceConnection.properties.privateLinkServiceConnectionState.status)\n| extend targetResourceId = tostring(privateLinkServiceConnection.properties.privateLinkServiceId)\n| extend targetResourceName = tostring(split(targetResourceId, '/')[-1])\n| extend targetResourceType = tostring(split(targetResourceId, '/')[-2])\n| extend groupIds = tostring(privateLinkServiceConnection.properties.groupIds[0])\n| extend DORACompliance = case(\n    connectionState == 'Approved', 'Article 9.3a Compliant',\n    connectionState == 'Pending', 'Pending Approval',\n    'Non-Compliant'\n)\n| project \n    ['Private Endpoint'] = privateEndpointName,\n    ['DORA Status'] = DORACompliance,\n    ['Connection State'] = connectionState,\n    ['Target Resource'] = targetResourceName,\n    ['Target Type'] = targetResourceType,\n    ['Sub Resource'] = groupIds,\n    ['Virtual Network'] = vnetName,\n    ['Subnet'] = subnetName,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['Target Resource ID'] = targetResourceId\n| order by ['DORA Status'] asc, ['Private Endpoint'] asc",
              "size": 0,
              "title": "Private Endpoints Inventory - Article 9.3a Network Isolation",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Private Endpoint",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Connection State",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Approved",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Target Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora private endpoints detail"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/privateendpoints'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| mv-expand privateLinkServiceConnection = properties.privateLinkServiceConnections\n| extend targetResourceId = tostring(privateLinkServiceConnection.properties.privateLinkServiceId)\n| extend targetResourceType = tostring(split(targetResourceId, '/providers/')[-1])\n| extend targetType = tostring(split(targetResourceType, '/')[0])\n| summarize Count = count() by targetType\n| order by Count desc\n| project ['Target Resource Type'] = targetType, ['Private Endpoint Count'] = Count",
              "size": 0,
              "title": "Private Endpoints by Target Resource Type",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "barchart"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - pe by target type"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.storage/storageaccounts',\n    'microsoft.keyvault/vaults',\n    'microsoft.sql/servers',\n    'microsoft.dbforpostgresql/flexibleservers',\n    'microsoft.dbformysql/flexibleservers',\n    'microsoft.documentdb/databaseaccounts',\n    'microsoft.containerregistry/registries',\n    'microsoft.cache/redis',\n    'microsoft.eventhub/namespaces',\n    'microsoft.servicebus/namespaces',\n    'microsoft.web/sites',\n    'microsoft.cognitiveservices/accounts',\n    'microsoft.apimanagement/service',\n    'microsoft.search/searchservices'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend resourceType = case(\n    type =~ 'microsoft.storage/storageaccounts', 'Storage Account',\n    type =~ 'microsoft.keyvault/vaults', 'Key Vault',\n    type =~ 'microsoft.sql/servers', 'SQL Server',\n    type =~ 'microsoft.dbforpostgresql/flexibleservers', 'PostgreSQL',\n    type =~ 'microsoft.dbformysql/flexibleservers', 'MySQL',\n    type =~ 'microsoft.documentdb/databaseaccounts', 'Cosmos DB',\n    type =~ 'microsoft.containerregistry/registries', 'Container Registry',\n    type =~ 'microsoft.cache/redis', 'Redis Cache',\n    type =~ 'microsoft.eventhub/namespaces', 'Event Hub',\n    type =~ 'microsoft.servicebus/namespaces', 'Service Bus',\n    type =~ 'microsoft.web/sites', 'App Service',\n    type =~ 'microsoft.cognitiveservices/accounts', 'Cognitive Services',\n    type =~ 'microsoft.apimanagement/service', 'API Management',\n    type =~ 'microsoft.search/searchservices', 'Search Service',\n    type\n)\n| extend publicNetworkAccess = case(\n    type =~ 'microsoft.storage/storageaccounts', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.keyvault/vaults', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.sql/servers', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.containerregistry/registries', tostring(properties.publicNetworkAccess),\n    type =~ 'microsoft.cognitiveservices/accounts', tostring(properties.publicNetworkAccess),\n    'Unknown'\n)\n| extend privateEndpointConnections = properties.privateEndpointConnections\n| extend peCount = array_length(privateEndpointConnections)\n| extend hasPrivateEndpoint = peCount > 0\n| extend DORACompliance = case(\n    hasPrivateEndpoint and publicNetworkAccess =~ 'SecuredByPerimeter', 'Has PE / Network Security Perimeter',\n    hasPrivateEndpoint and publicNetworkAccess =~ 'Disabled', 'Fully Isolated',\n    hasPrivateEndpoint and publicNetworkAccess =~ 'Enabled', 'Has PE - Has Public Access',\n    hasPrivateEndpoint and publicNetworkAccess =~ 'Unknown', 'Has PE - Check Public Access',\n    hasPrivateEndpoint, 'Has PE - Public Access Enabled',\n    publicNetworkAccess =~ 'Unknown', 'Check Configuration',\n    peCount == 0 and publicNetworkAccess =~ 'Enabled', 'No PE - Has Public Access',\n    peCount == 0 and publicNetworkAccess =~ 'Disabled', 'No PE - No Public Access',\n    'No Private Endpoint'\n)\n| project \n    ['Resource Name'] = name,\n    ['Resource Type'] = resourceType,\n    ['DORA Status'] = DORACompliance,\n    ['Private Endpoints'] = peCount,\n    ['Public Network'] = publicNetworkAccess,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3a',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc, ['Resource Type'] asc, ['Resource Name'] asc",
              "size": 0,
              "title": "PaaS Resources - Private Endpoint Coverage (Article 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource Name",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Isolated",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Has PE",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Private Endpoints",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": ">",
                          "thresholdValue": "0",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ],
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": []
                      }
                    },
                    "numberFormat": {
                      "unit": 0,
                      "options": {
                        "style": "decimal"
                      }
                    }
                  },
                  {
                    "columnMatch": "Public Network",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Disabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Enabled",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "unknown",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - paas private endpoint coverage"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ’¾ Article 9.3a & 11 - Business Continuity & Backup Services\n\n**DORA Article 11** requires comprehensive business continuity management including **backup policies, geo-redundancy, disaster recovery capabilities, and regular testing**.\n\n**DORA Article 9.3a** additionally requires these services to use **private endpoints** for secure backup traffic.\n\n**Covered Services**: Azure Recovery Services Vaults (Backup & Site Recovery)\n\n### ğŸ”„ Recovery Services Vaults - Backup & Disaster Recovery"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "text - article 11 business continuity header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.recoveryservices/vaults'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend vaultType = tostring(properties.type)\n| extend redundancySettings = properties.redundancySettings\n| extend backupStorageType = tostring(redundancySettings.standardTierStorageRedundancy)\n| extend crossRegionRestore = tobool(redundancySettings.crossRegionRestore)\n| extend softDeleteState = tostring(properties.securitySettings.softDeleteSettings.softDeleteState)\n| extend immutableState = tostring(properties.securitySettings.immutabilitySettings.immutabilityState)\n| extend privateEndpointConnections = properties.privateEndpointConnections\n| extend hasPrivateEndpoint = isnotnull(privateEndpointConnections) and array_length(privateEndpointConnections) > 0\n| extend privateEndpointState = case(\n    hasPrivateEndpoint, tostring(privateEndpointConnections[0].properties.privateLinkServiceConnectionState.status),\n    'No Private Endpoint'\n)\n| extend geoRedundant = backupStorageType in~ ('GeoRedundant', 'ReadAccessGeoZoneRedundant', 'ZoneRedundant')\n| extend softDeleteEnabled = softDeleteState =~ 'Enabled'\n| extend immutableVault = immutableState =~ 'Enabled'\n| extend DORAArticle11Compliance = case(\n    geoRedundant and crossRegionRestore and softDeleteEnabled and immutableVault, 'Article 11 Fully Compliant',\n    geoRedundant and crossRegionRestore and softDeleteEnabled, 'Missing Immutability Protection',\n    geoRedundant and softDeleteEnabled, 'Missing Cross-Region Restore',\n    geoRedundant, 'Missing Soft Delete or CRR',\n    'Not Geo-Redundant'\n)\n| extend DORAArticle93aCompliance = case(\n    hasPrivateEndpoint and privateEndpointState =~ 'Approved', 'Article 9.3a Compliant',\n    hasPrivateEndpoint, 'Private Endpoint Pending',\n    'No Private Endpoint'\n)\n| extend serviceType = 'Recovery Services'\n| project \n    ['Recovery Vault'] = name,\n    ['Service Type'] = serviceType,\n    ['Article 11 Compliance'] = DORAArticle11Compliance,\n    ['Article 9.3a Compliance'] = DORAArticle93aCompliance,\n    ['Backup Storage'] = backupStorageType,\n    ['Cross-Region Restore'] = case(crossRegionRestore == true, 'Enabled', 'Disabled'),\n    ['Soft Delete'] = case(softDeleteEnabled, 'Enabled', 'Disabled'),\n    ['Immutable Vault'] = case(immutableVault, 'Enabled', 'Disabled'),\n    ['Private Endpoint'] = case(hasPrivateEndpoint, 'Yes', 'No'),\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Articles'] = 'Article 11 (BC) & 9.3a (Network)',\n    ['Resource ID'] = id\n| order by ['Article 11 Compliance'] asc, ['Article 9.3a Compliance'] asc",
              "size": 0,
              "title": "Recovery Services Vaults - Business Continuity & Backup Compliance (Articles 11 & 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Recovery Vault",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Article 11 Compliance",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Missing",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Article 9.3a Compliance",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "9.3a Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Pending",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Cross-Region Restore",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Soft Delete",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Immutable Vault",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Private Endpoint",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora recovery services"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ” Article 9.3b - Access Control and Authorization\n\nDORA Article 9.3b requires robust access controls including **RBAC authorization, VM backup policies, geo-redundant backup, and Customer Managed Key (CMK) encryption**.\n\n### ğŸ” Key Vault RBAC Authorization"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "text - article 9.3b header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.keyvault/vaults'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend enableRbac = tobool(properties.enableRbacAuthorization)\n| extend softDelete = tobool(properties.enableSoftDelete)\n| extend purgeProtection = tobool(properties.enablePurgeProtection)\n| extend networkAcls = properties.networkAcls\n| extend defaultAction = tostring(networkAcls.defaultAction)\n| extend DORACompliance = case(\n    enableRbac == true and softDelete == true and purgeProtection == true, 'Fully Compliant',\n    enableRbac == true and softDelete == true, 'Missing Purge Protection',\n    enableRbac == true, 'Partial Compliance',\n    'Non-Compliant - No RBAC'\n)\n| project \n    ['Key Vault'] = name,\n    ['DORA Status'] = DORACompliance,\n    ['RBAC Enabled'] = case(enableRbac == true, 'Yes', 'No'),\n    ['Soft Delete'] = case(softDelete == true, 'Yes', 'No'),\n    ['Purge Protection'] = case(purgeProtection == true, 'Yes', 'No'),\n    ['Network Default'] = defaultAction,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3b',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "Key Vault - RBAC Authorization & Protection (Article 9.3b)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Key Vault",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Missing",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "RBAC Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Soft Delete",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Purge Protection",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "query - dora keyvault"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ’¾ Storage Account Encryption & Security (Article 9.3b)"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "text - article 9.3b storage"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.storage/storageaccounts'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend skuName = tostring(sku.name)\n| extend isZoneRedundant = (skuName contains 'ZRS' or skuName contains 'GZRS')\n| extend isGeoRedundant = (skuName contains 'GRS' or skuName contains 'GZRS' or skuName contains 'RA-GRS' or skuName contains 'RA-GZRS')\n| extend httpsOnly = tobool(properties.supportsHttpsTrafficOnly)\n| extend minTlsVersion = tostring(properties.minimumTlsVersion)\n| extend encryption = properties.encryption\n| extend cmkEnabled = isnotnull(encryption.keyvaultproperties)\n| extend storageKind = tostring(kind)\n| extend accessTier = tostring(properties.accessTier)\n| extend DORACompliance = case(\n    isZoneRedundant and httpsOnly == true and (minTlsVersion == 'TLS1_2' or minTlsVersion == 'TLS1_3'), 'Fully Compliant',\n    isGeoRedundant and httpsOnly == true, 'Geo-Redundant Only',\n    httpsOnly == true, 'HTTPS Only - No Zone/Geo',\n    'Non-Compliant'\n)\n| extend RiskLevel = case(\n    isZoneRedundant and httpsOnly == true, 'Low',\n    isGeoRedundant and httpsOnly == true, 'Medium',\n    httpsOnly == true, 'Medium',\n    'High'\n)\n| project \n    ['Storage Account'] = name,\n    ['DORA Compliance'] = DORACompliance,\n    ['Risk Level'] = RiskLevel,\n    ['Replication'] = skuName,\n    ['CMK Enabled'] = case(cmkEnabled, 'Yes', 'No'),\n    ['HTTPS Only'] = case(httpsOnly == true, 'Yes', 'No'),\n    ['Min TLS'] = minTlsVersion,\n    ['Kind'] = storageKind,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3b/9.3c',\n    ['Resource ID'] = id\n| order by ['Risk Level'] desc, ['Storage Account'] asc",
              "size": 0,
              "title": "Storage Accounts - Encryption & Redundancy (Article 9.3b)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Storage Account",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Compliance",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Geo-Redundant",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Risk Level",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "CMK Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "HTTPS Only",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "query - dora storage encryption"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ—„ï¸ Container Registry Security (Article 9.3b)"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "text - article 9.3b acr"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.containerregistry/registries'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend skuName = tostring(sku.name)\n| extend adminEnabled = tobool(properties.adminUserEnabled)\n| extend publicNetworkAccess = tostring(properties.publicNetworkAccess)\n| extend encryption = properties.encryption\n| extend cmkEnabled = tostring(encryption.status) == 'enabled'\n| extend zoneRedundancy = tostring(properties.zoneRedundancy)\n| extend DORACompliance = case(\n    adminEnabled == false and publicNetworkAccess == 'Disabled', 'Fully Compliant',\n    adminEnabled == false, 'Admin Disabled - Public Access',\n    'Non-Compliant - Admin Enabled'\n)\n| project \n    ['Container Registry'] = name,\n    ['DORA Status'] = DORACompliance,\n    ['SKU'] = skuName,\n    ['Admin User'] = case(adminEnabled == true, 'Enabled', 'Disabled'),\n    ['Public Access'] = publicNetworkAccess,\n    ['CMK Enabled'] = case(cmkEnabled, 'Yes', 'No'),\n    ['Zone Redundant'] = zoneRedundancy,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3b',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "Container Registry - Security Configuration (Article 9.3b)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Container Registry",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Admin Disabled",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Admin User",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Disabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "CMK Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "query - dora acr"
          },
          {
            "type": 1,
            "content": {
              "json": "### â˜¸ï¸ AKS RBAC & Security (Article 9.3b)\n\nDORA policy requires **Role-Based Access Control (RBAC) should be used on Kubernetes Services**."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "text - article 9.3b aks rbac"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.containerservice/managedclusters'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend enableRbac = tobool(properties.enableRBAC)\n| extend aadEnabled = isnotnull(properties.aadProfile)\n| extend azureRbacEnabled = tobool(properties.aadProfile.enableAzureRBAC)\n| extend localAccounts = tobool(properties.disableLocalAccounts) != true\n| extend networkPolicy = tostring(properties.networkProfile.networkPolicy)\n| extend tier = tostring(sku.tier)\n| extend hasZones = isnotempty(zones) or isnotempty(properties.agentPoolProfiles[0].availabilityZones)\n| extend DORACompliance = case(\n    enableRbac == true and aadEnabled and azureRbacEnabled == true and localAccounts == false, 'Fully Compliant',\n    enableRbac == true and aadEnabled and azureRbacEnabled == true, 'Local Accounts Enabled',\n    enableRbac == true and aadEnabled, 'Azure RBAC Not Enabled',\n    enableRbac == true, 'AAD Not Integrated',\n    'Non-Compliant - RBAC Disabled'\n)\n| project \n    ['AKS Cluster'] = name,\n    ['DORA Status'] = DORACompliance,\n    ['K8s RBAC'] = case(enableRbac == true, 'Enabled', 'Disabled'),\n    ['AAD Integrated'] = case(aadEnabled, 'Yes', 'No'),\n    ['Azure RBAC'] = case(azureRbacEnabled == true, 'Yes', 'No'),\n    ['Local Accounts'] = case(localAccounts, 'Enabled', 'Disabled'),\n    ['Network Policy'] = coalesce(networkPolicy, 'None'),\n    ['Tier'] = tier,\n    ['Zone Redundant'] = case(hasZones, 'Yes', 'No'),\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3b',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "AKS Clusters - RBAC & Security Configuration (Article 9.3b)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AKS Cluster",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Local Accounts Enabled",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "K8s RBAC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "AAD Integrated",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Azure RBAC",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Local Accounts",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Disabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Zone Redundant",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3b"
            },
            "name": "query - dora aks rbac"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ”’ Article 9.3c - Data Protection and Encryption\n\nDORA Article 9.3c requires **key rotation policies, system updates, CMK encryption for all data services, and soft delete protection**.\n\n### ğŸ—ƒï¸ Database High Availability & Zone Redundancy"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "text - article 9.3c header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.sql/servers/databases',\n    'microsoft.dbforpostgresql/flexibleservers',\n    'microsoft.dbformysql/flexibleservers',\n    'microsoft.cache/redis',\n    'microsoft.documentdb/databaseaccounts'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend hasZones = isnotempty(zones) or tobool(properties.zoneRedundant) or tobool(properties.highAvailability.mode == 'ZoneRedundant')\n| extend \n    databaseType = case(\n        type =~ 'microsoft.sql/servers/databases', 'SQL Database',\n        type =~ 'microsoft.dbforpostgresql/flexibleservers', 'PostgreSQL',\n        type =~ 'microsoft.dbformysql/flexibleservers', 'MySQL',\n        type =~ 'microsoft.cache/redis', 'Redis Cache',\n        type =~ 'microsoft.documentdb/databaseaccounts', 'Cosmos DB',\n        type\n    )\n| extend haMode = case(\n    type =~ 'microsoft.dbforpostgresql/flexibleservers', tostring(properties.highAvailability.mode),\n    type =~ 'microsoft.dbformysql/flexibleservers', tostring(properties.highAvailability.mode),\n    type =~ 'microsoft.documentdb/databaseaccounts', case(tobool(properties.enableMultipleWriteLocations), 'Multi-Region', 'Single-Region'),\n    'N/A'\n)\n| extend DORACompliance = case(\n    hasZones, 'Article 9.3c Compliant',\n    'Non-Compliant'\n)\n| project \n    ['Database'] = name,\n    ['Type'] = databaseType,\n    ['DORA Status'] = DORACompliance,\n    ['HA Mode'] = haMode,\n    ['Zone Redundant'] = case(hasZones, 'Yes', 'No'),\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3c',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc, ['Database'] asc",
              "size": 0,
              "title": "Databases - High Availability & Zone Redundancy (Article 9.3c)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Database",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Zone Redundant",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "query - dora databases ha"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ”‘ Key Vault Protection (Article 9.3c)\n\nDORA policy requires **soft delete and purge protection** for Key Vaults to protect against accidental or malicious deletion.\n\n> âš ï¸ **Note:** Key Vault keys/secrets expiration details require `microsoft.keyvault/vaults/keys` resource type which has limited ARG support. Use **Azure Policy** for key expiration and rotation enforcement."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "text - article 9.3c keyvault keys"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.keyvault/vaults'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend enableRbac = tobool(properties.enableRbacAuthorization)\n| extend softDelete = tobool(properties.enableSoftDelete)\n| extend purgeProtection = tobool(properties.enablePurgeProtection)\n| extend softDeleteRetention = toint(properties.softDeleteRetentionInDays)\n| extend enabledForDeployment = tobool(properties.enabledForDeployment)\n| extend enabledForDiskEncryption = tobool(properties.enabledForDiskEncryption)\n| extend enabledForTemplateDeployment = tobool(properties.enabledForTemplateDeployment)\n| extend vaultUri = tostring(properties.vaultUri)\n| extend DORAKeyRotation = case(\n    softDelete == true and purgeProtection == true and softDeleteRetention >= 90, 'Key Protection Ready',\n    softDelete == true and purgeProtection == true, 'Short Retention Period',\n    softDelete == true, 'Missing Purge Protection',\n    'Non-Compliant'\n)\n| project \n    ['Key Vault'] = name,\n    ['DORA Status'] = DORAKeyRotation,\n    ['Soft Delete'] = case(softDelete == true, 'Yes', 'No'),\n    ['Purge Protection'] = case(purgeProtection == true, 'Yes', 'No'),\n    ['Retention Days'] = softDeleteRetention,\n    ['RBAC Enabled'] = case(enableRbac == true, 'Yes', 'No'),\n    ['For Deployment'] = case(enabledForDeployment == true, 'Yes', 'No'),\n    ['For Disk Encryption'] = case(enabledForDiskEncryption == true, 'Yes', 'No'),\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3c',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "Key Vault - Key Protection Settings (Article 9.3c)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Key Vault",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Key Protection Ready",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Short Retention",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Soft Delete",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Purge Protection",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Retention Days",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": ">=",
                          "thresholdValue": "90",
                          "representation": "green",
                          "text": "{0} days"
                        },
                        {
                          "operator": ">=",
                          "thresholdValue": "30",
                          "representation": "yellow",
                          "text": "{0} days"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "redBright",
                          "text": "{0} days"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "query - dora keyvault keys"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ³ Container & Kubernetes Services (Article 9.3c)"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "text - article 9.3c containers"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.containerservice/managedclusters',\n    'microsoft.app/containerapps'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend hasZones = isnotempty(zones)\n| extend \n    serviceType = case(\n        type =~ 'microsoft.containerservice/managedclusters', 'AKS Cluster',\n        type =~ 'microsoft.app/containerapps', 'Container App',\n        type\n    )\n| extend \n    tier = case(\n        type =~ 'microsoft.containerservice/managedclusters', tostring(sku.tier),\n        type =~ 'microsoft.app/containerapps', tostring(properties.managedEnvironmentId),\n        'N/A'\n    )\n| extend networkProfile = case(\n    type =~ 'microsoft.containerservice/managedclusters', tostring(properties.networkProfile.networkPlugin),\n    'N/A'\n)\n| extend DORACompliance = case(\n    hasZones, 'Zone Redundant',\n    'No Zone Redundancy'\n)\n| project \n    ['Service Name'] = name,\n    ['Type'] = serviceType,\n    ['DORA Status'] = DORACompliance,\n    ['Tier'] = tier,\n    ['Network Plugin'] = networkProfile,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3c',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc, ['Service Name'] asc",
              "size": 0,
              "title": "Container Services - Zone Redundancy (Article 9.3c)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Service Name",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Zone Redundant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "query - dora containers"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸŒ App Services & Web Apps (Article 9.3c)"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "text - article 9.3c appservices"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.web/sites'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend hasZones = isnotempty(zones)\n| extend httpsOnly = tobool(properties.httpsOnly)\n| extend minTlsVersion = coalesce(tostring(properties.siteConfig.minTlsVersion), 'Not Set')\n| extend ftpsState = coalesce(tostring(properties.siteConfig.ftpsState), 'Not Set')\n| extend appKind = coalesce(tostring(kind), 'app')\n| extend tlsCompliant = minTlsVersion in ('1.2', '1.3', 'TLS1_2', 'TLS1_3')\n| extend DORACompliance = case(\n    httpsOnly == true and ftpsState in ('FtpsOnly', 'Disabled') and tlsCompliant, 'Fully Compliant',\n    httpsOnly == true and ftpsState in ('FtpsOnly', 'Disabled'), 'Check TLS Version',\n    httpsOnly == true, 'FTPS Not Enforced',\n    'Non-Compliant'\n)\n| project \n    AppService = name,\n    Kind = appKind,\n    DORAStatus = DORACompliance,\n    HTTPSOnly = case(httpsOnly == true, 'Yes', 'No'),\n    FTPSState = ftpsState,\n    MinTLS = minTlsVersion,\n    ZoneRedundant = case(hasZones, 'Yes', 'No'),\n    ResourceGroup = resourceGroup,\n    Subscription = subscriptionId,\n    Location = location,\n    DORAArticle = '9.3a/9.3c',\n    ResourceID = id\n| order by DORAStatus asc, AppService asc",
              "size": 0,
              "title": "App Services - HTTPS/FTPS/TLS Compliance (Article 9.3c)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AppService",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORAStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": " {0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Check",
                          "representation": "warning",
                          "text": " {0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "FTPS",
                          "representation": "warning",
                          "text": " {0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": " {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "HTTPSOnly",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": " {0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": " {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ZoneRedundant",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": " {0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": " {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "ResourceID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "query - dora appservices"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ”Œ Integration Services (Article 9.3c)"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "text - article 9.3c integration"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.apimanagement/service',\n    'microsoft.eventhub/namespaces',\n    'microsoft.servicebus/namespaces'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend hasZones = isnotempty(zones)\n| extend \n    serviceType = case(\n        type =~ 'microsoft.apimanagement/service', 'API Management',\n        type =~ 'microsoft.eventhub/namespaces', 'Event Hubs',\n        type =~ 'microsoft.servicebus/namespaces', 'Service Bus',\n        type\n    )\n| extend \n    tier = tostring(sku.name)\n| extend DORACompliance = case(\n    hasZones, 'Zone Redundant',\n    'No Zone Redundancy'\n)\n| project \n    ['Service Name'] = name,\n    ['Type'] = serviceType,\n    ['DORA Status'] = DORACompliance,\n    ['SKU'] = tier,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3c',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc, ['Service Name'] asc",
              "size": 0,
              "title": "Integration Services - Zone Redundancy (Article 9.3c)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Service Name",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": " Zone Redundant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "query - dora integration"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ”’ API Management - Encrypted Protocols Only (Article 9.3a)\n\nDORA policy requires **API Management APIs should use only encrypted protocols**."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "text - article 9.3a apim tls"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.apimanagement/service'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend skuName = tostring(sku.name)\n| extend protocols = properties.customProperties\n| extend http2Enabled = tobool(protocols['Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2'])\n| extend tlsEnabled = tobool(protocols['Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls12'])\n| extend tls10Disabled = protocols['Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10'] == 'False'\n| extend tls11Disabled = protocols['Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11'] == 'False'\n| extend ssl30Disabled = protocols['Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30'] == 'False'\n| extend hasVnet = isnotnull(properties.virtualNetworkConfiguration)\n| extend vnetType = tostring(properties.virtualNetworkType)\n| extend hasPrivateEndpoint = isnotnull(properties.privateEndpointConnections) and array_length(properties.privateEndpointConnections) > 0\n| extend publicNetworkAccess = tostring(properties.publicNetworkAccess)\n| extend DORACompliance = case(\n    tls10Disabled and tls11Disabled and ssl30Disabled and hasPrivateEndpoint, 'Fully Compliant',\n    tls10Disabled and tls11Disabled and ssl30Disabled, 'Secure TLS - No PE',\n    hasPrivateEndpoint, 'Has PE - Check TLS Settings',\n    'Non-Compliant - Legacy Protocols'\n)\n| project \n    ['APIM Service'] = name,\n    ['DORA Status'] = DORACompliance,\n    ['SKU'] = skuName,\n    ['TLS 1.0 Disabled'] = case(tls10Disabled, 'Yes', 'No'),\n    ['TLS 1.1 Disabled'] = case(tls11Disabled, 'Yes', 'No'),\n    ['SSL 3.0 Disabled'] = case(ssl30Disabled, 'Yes', 'No'),\n    ['Private Endpoint'] = case(hasPrivateEndpoint, 'Yes', 'No'),\n    ['VNet Type'] = coalesce(vnetType, 'None'),\n    ['Public Access'] = coalesce(publicNetworkAccess, 'Enabled'),\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3a',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "API Management - Protocol Security (Article 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "APIM Service",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Secure TLS",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "TLS 1.0 Disabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "TLS 1.1 Disabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "SSL 3.0 Disabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Private Endpoint",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora apim tls"
          },
          {
            "type": 1,
            "content": {
              "json": "### Analytics & AI Services - Private Link (Article 9.3a)\n\nThese analytics and AI services are required by DORA policy to use private link for network isolation.\n\n**Covered Services**: Azure Databricks, Azure ML, Synapse Analytics, Azure AI Search, Azure OpenAI, Cognitive Services"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "text - article 9.3a ml services"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.databricks/workspaces',\n    'microsoft.machinelearningservices/workspaces',\n    'microsoft.synapse/workspaces',\n    'microsoft.search/searchservices',\n    'microsoft.cognitiveservices/accounts',\n    'microsoft.openai/accounts'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend serviceType = case(\n    type =~ 'microsoft.databricks/workspaces', 'Azure Databricks',\n    type =~ 'microsoft.machinelearningservices/workspaces', 'Azure ML',\n    type =~ 'microsoft.synapse/workspaces', 'Azure Synapse',\n    type =~ 'microsoft.search/searchservices', 'Azure AI Search',\n    type =~ 'microsoft.cognitiveservices/accounts', 'Cognitive Services',\n    type =~ 'microsoft.openai/accounts', 'Azure OpenAI',\n    type\n)\n| extend hasPrivateEndpoint = isnotnull(properties.privateEndpointConnections) and array_length(properties.privateEndpointConnections) > 0\n| extend publicNetworkAccess = coalesce(\n    tostring(properties.publicNetworkAccess),\n    tostring(properties.networkAcls.defaultAction),\n    'Not Set'\n)\n| extend DORACompliance = case(\n    hasPrivateEndpoint and publicNetworkAccess =~ 'Disabled', 'Fully Compliant',\n    hasPrivateEndpoint, 'PE Enabled - Public Access On',\n    publicNetworkAccess =~ 'Disabled', 'Public Disabled - No PE',\n    'Non-Compliant'\n)\n| project \n    ['Service Name'] = name,\n    ['Type'] = serviceType,\n    ['DORA Status'] = DORACompliance,\n    ['Private Endpoint'] = case(hasPrivateEndpoint, 'Yes', 'No'),\n    ['Public Access'] = publicNetworkAccess,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3a',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc, ['Service Name'] asc",
              "size": 0,
              "title": "Analytics & AI Services - Private Link Compliance (Article 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Service Name",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "PE Enabled",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Private Endpoint",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3c"
            },
            "name": "query - dora ml services private link"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.databricks/workspaces'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend enableNoPublicIp = tobool(properties.parameters.enableNoPublicIp.value)\n| extend publicNetworkAccess = tostring(properties.publicNetworkAccess)\n| extend hasPrivateEndpoint = isnotnull(properties.privateEndpointConnections) and array_length(properties.privateEndpointConnections) > 0\n| extend pricingTier = tostring(sku.name)\n| extend DORACompliance = case(\n    enableNoPublicIp == true and hasPrivateEndpoint, 'Fully Compliant',\n    enableNoPublicIp == true, 'No Public IP - No PE',\n    hasPrivateEndpoint, 'PE Only - Public IP Enabled',\n    'Non-Compliant'\n)\n| project \n    ['Databricks Workspace'] = name,\n    ['DORA Status'] = DORACompliance,\n    ['No Public IP'] = case(enableNoPublicIp == true, 'Yes', 'No'),\n    ['Private Endpoint'] = case(hasPrivateEndpoint, 'Yes', 'No'),\n    ['Pricing Tier'] = pricingTier,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3a',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "Azure Databricks - Public IP & Private Link (Article 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Databricks Workspace",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "No Public IP",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "No Public IP",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Private Endpoint",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3a"
            },
            "name": "query - dora databricks"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ‘¤ Article 9.3d - Identity and Authentication\n\nDORA Article 9.3d requires **Azure AD-only authentication for databases, multiple subscription owners, and proper identity governance**.\n\n### ğŸ” SQL & MySQL AAD-Only Authentication"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3d"
            },
            "name": "text - article 9.3d header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.sql/servers'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend aadOnlyAuth = tobool(properties.administrators.azureADOnlyAuthentication)\n| extend aadAdmin = tostring(properties.administrators.login)\n| extend publicNetworkAccess = tostring(properties.publicNetworkAccess)\n| extend minTlsVersion = tostring(properties.minimalTlsVersion)\n| extend DORACompliance = case(\n    aadOnlyAuth == true, 'AAD-Only Compliant',\n    isnotnull(aadAdmin) and aadAdmin != '', 'AAD Admin Set - SQL Auth Enabled',\n    'Non-Compliant - No AAD'\n)\n| project \n    ['SQL Server'] = name,\n    ['DORA Status'] = DORACompliance,\n    ['AAD-Only Auth'] = case(aadOnlyAuth == true, 'Enabled', 'Disabled'),\n    ['AAD Admin'] = aadAdmin,\n    ['Public Network'] = publicNetworkAccess,\n    ['Min TLS'] = minTlsVersion,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '9.3d',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "SQL Servers - Azure AD Authentication (Article 9.3d)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SQL Server",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "AAD-Only Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "AAD Admin Set",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "AAD-Only Auth",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3d"
            },
            "name": "query - dora sql aad"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ‘¥ Subscription Owners - Multiple Owners Required\n\nDORA policy requires **subscriptions to have more than one owner** to ensure continuity and proper governance. Maximum 3 owners recommended."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3d"
            },
            "name": "text - article 9.3d subscription owners"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "authorizationresources\n| where type =~ 'microsoft.authorization/roleassignments'\n| where properties.scope == strcat('/subscriptions/', subscriptionId)\n| extend roleDefinitionId = tostring(properties.roleDefinitionId)\n| where roleDefinitionId endswith '8e3af657-a8ff-443c-a75c-2fe8c4bcb635'\n| extend principalType = tostring(properties.principalType)\n| extend principalId = tostring(properties.principalId)\n| summarize \n    OwnerCount = count(),\n    UserOwners = countif(principalType == 'User'),\n    GroupOwners = countif(principalType == 'Group'),\n    ServicePrincipalOwners = countif(principalType == 'ServicePrincipal')\n    by subscriptionId\n| extend DORACompliance = case(\n    OwnerCount >= 2 and OwnerCount <= 3, 'Compliant (2-3 Owners)',\n    OwnerCount > 3, 'Too Many Owners',\n    OwnerCount == 1, 'Single Owner Risk',\n    'No Owners Found'\n)\n| join kind=leftouter (\n    resourcecontainers\n    | where type == 'microsoft.resources/subscriptions'\n    | project subscriptionId, subscriptionName = name\n) on subscriptionId\n| project \n    ['Subscription'] = coalesce(subscriptionName, subscriptionId),\n    ['DORA Status'] = DORACompliance,\n    ['Total Owners'] = OwnerCount,\n    ['User Owners'] = UserOwners,\n    ['Group Owners'] = GroupOwners,\n    ['Service Principal Owners'] = ServicePrincipalOwners,\n    ['DORA Article'] = '9.3d',\n    ['Subscription ID'] = subscriptionId\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "Subscription Owners - Multiple Owners Required (Article 9.3d)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Subscription ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Too Many",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Total Owners",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "2",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "3",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": ">",
                          "thresholdValue": "3",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "9.3d"
            },
            "name": "query - dora subscription owners"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ›¡ï¸ Article 10.1 - Detection and Monitoring\n\nDORA Article 10.1 requires **Microsoft Defender services enabled, activity logging, resource diagnostic logging, and continuous monitoring**.\n\n### ğŸ” Microsoft Defender for Cloud Status"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.1"
            },
            "name": "text - article 10.1 header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "securityresources\n| where type =~ 'microsoft.security/pricings'\n| extend pricingTier = tostring(properties.pricingTier)\n| extend resourceName = name\n| extend defenderPlan = case(\n    resourceName == 'VirtualMachines', 'Defender for Servers',\n    resourceName == 'SqlServers', 'Defender for SQL',\n    resourceName == 'AppServices', 'Defender for App Service',\n    resourceName == 'StorageAccounts', 'Defender for Storage',\n    resourceName == 'KeyVaults', 'Defender for Key Vault',\n    resourceName == 'Containers', 'Defender for Containers',\n    resourceName == 'Arm', 'Defender for Resource Manager',\n    resourceName == 'Dns', 'Defender for DNS',\n    resourceName == 'OpenSourceRelationalDatabases', 'Defender for Open Source DBs',\n    resourceName == 'CosmosDbs', 'Defender for Cosmos DB',\n    resourceName == 'CloudPosture', 'Defender CSPM',\n    resourceName\n)\n| extend DORACompliance = case(\n    pricingTier == 'Standard', 'Enabled',\n    'Not Enabled'\n)\n| project \n    ['Defender Plan'] = defenderPlan,\n    ['Resource Name'] = resourceName,\n    ['DORA Status'] = DORACompliance,\n    ['Pricing Tier'] = pricingTier,\n    ['Subscription'] = subscriptionId,\n    ['DORA Article'] = '10.1'\n| order by ['DORA Status'] asc, ['Defender Plan'] asc",
              "size": 0,
              "title": "Microsoft Defender for Cloud - Plan Status (Article 10.1)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Pricing Tier",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Standard",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.1"
            },
            "name": "query - dora defender plans"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ“‹ Activity Log Export - Subscription Diagnostic Settings\n\nDORA requires **Activity Logs to be exported** to Log Analytics, Storage, or Event Hub for audit and incident response."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.1"
            },
            "name": "text - article 10.1 activity logs"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.insights/diagnosticsettings'\n| where id contains '/providers/microsoft.insights/diagnosticSettings'\n| where id !contains '/providers/Microsoft.' or id contains '/subscriptions/' and id !contains '/resourceGroups/'\n| extend settingName = name\n| extend workspaceId = tostring(properties.workspaceId)\n| extend storageAccountId = tostring(properties.storageAccountId)\n| extend eventHubAuthRuleId = tostring(properties.eventHubAuthorizationRuleId)\n| extend hasWorkspace = isnotempty(workspaceId)\n| extend hasStorage = isnotempty(storageAccountId)\n| extend hasEventHub = isnotempty(eventHubAuthRuleId)\n| extend logs = properties.logs\n| extend logsEnabled = isnotnull(logs) and array_length(logs) > 0\n| extend destinations = strcat(\n    iff(hasWorkspace, 'ğŸ“Š Log Analytics ', ''),\n    iff(hasStorage, 'ğŸ’¾ Storage ', ''),\n    iff(hasEventHub, 'ğŸ“¡ Event Hub', '')\n)\n| extend DORACompliance = case(\n    hasWorkspace and logsEnabled, 'Fully Compliant',\n    hasStorage and logsEnabled, 'Storage Only',\n    logsEnabled, 'Partial Config',\n    'No Logs Exported'\n)\n| project \n    ['Setting Name'] = settingName,\n    ['DORA Status'] = DORACompliance,\n    ['Destinations'] = destinations,\n    ['Log Analytics'] = case(hasWorkspace, 'Yes', 'No'),\n    ['Storage Account'] = case(hasStorage, 'Yes', 'No'),\n    ['Event Hub'] = case(hasEventHub, 'Yes', 'No'),\n    ['Subscription'] = subscriptionId,\n    ['DORA Article'] = '10.1',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc",
              "size": 0,
              "title": "Activity Log Diagnostic Settings (Article 10.1)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Storage Only",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Log Analytics",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Storage Account",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Event Hub",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.1"
            },
            "name": "query - dora activity log settings"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ“Š Resource Diagnostic Settings - Critical Resources\n\nDORA requires **diagnostic logging enabled for critical resources** including Key Vaults, Storage, Databases, and App Services."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.1"
            },
            "name": "text - article 10.1 resource diag"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in~ (\n    'microsoft.keyvault/vaults',\n    'microsoft.storage/storageaccounts',\n    'microsoft.sql/servers',\n    'microsoft.web/sites',\n    'microsoft.containerservice/managedclusters',\n    'microsoft.documentdb/databaseaccounts',\n    'microsoft.dbforpostgresql/flexibleservers',\n    'microsoft.dbformysql/flexibleservers',\n    'microsoft.apimanagement/service',\n    'microsoft.eventhub/namespaces',\n    'microsoft.servicebus/namespaces'\n)\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend resourceType = case(\n    type =~ 'microsoft.keyvault/vaults', 'Key Vault',\n    type =~ 'microsoft.storage/storageaccounts', 'Storage Account',\n    type =~ 'microsoft.sql/servers', 'SQL Server',\n    type =~ 'microsoft.web/sites', 'App Service',\n    type =~ 'microsoft.containerservice/managedclusters', 'AKS Cluster',\n    type =~ 'microsoft.documentdb/databaseaccounts', 'Cosmos DB',\n    type =~ 'microsoft.dbforpostgresql/flexibleservers', 'PostgreSQL',\n    type =~ 'microsoft.dbformysql/flexibleservers', 'MySQL',\n    type =~ 'microsoft.apimanagement/service', 'API Management',\n    type =~ 'microsoft.eventhub/namespaces', 'Event Hub',\n    type =~ 'microsoft.servicebus/namespaces', 'Service Bus',\n    type\n)\n| join kind=leftouter (\n    resources\n    | where type =~ 'microsoft.insights/diagnosticsettings'\n    | extend parentResource = tostring(split(id, '/providers/microsoft.insights/')[0])\n    | extend hasWorkspace = isnotempty(tostring(properties.workspaceId))\n    | extend hasStorage = isnotempty(tostring(properties.storageAccountId))\n    | extend logsEnabled = isnotnull(properties.logs) and array_length(properties.logs) > 0\n    | summarize \n        DiagSettingsCount = count(),\n        HasLogAnalytics = max(iff(hasWorkspace, 1, 0)),\n        HasStorage = max(iff(hasStorage, 1, 0)),\n        LogsConfigured = max(iff(logsEnabled, 1, 0))\n        by parentResource\n) on $left.id == $right.parentResource\n| extend hasDiagSettings = DiagSettingsCount > 0\n| extend DORACompliance = case(\n    hasDiagSettings and HasLogAnalytics == 1 and LogsConfigured == 1, 'Fully Compliant',\n    hasDiagSettings and LogsConfigured == 1, 'Logs Enabled - No Log Analytics',\n    hasDiagSettings, 'Diag Settings - Check Logs',\n    'No Diagnostic Settings'\n)\n| project \n    ['Resource Name'] = name,\n    ['Resource Type'] = resourceType,\n    ['DORA Status'] = DORACompliance,\n    ['Diag Settings'] = iff(hasDiagSettings, strcat(' ', DiagSettingsCount, 'Setting(s)'), 'Zone'),\n    ['Log Analytics'] = case(HasLogAnalytics == 1, 'Yes', 'No'),\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    ['DORA Article'] = '10.1',\n    ['Resource ID'] = id\n| order by ['DORA Status'] asc, ['Resource Type'] asc",
              "size": 0,
              "title": "Resource Diagnostic Settings Coverage (Article 10.1)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Resource Name",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Fully Compliant",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Logs Enabled",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Diag Settings",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "setting",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Log Analytics",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": " Yes",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.1"
            },
            "name": "query - dora resource diag settings"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ“Š Article 10.2 - Incident Response and Logging\n\nDORA Article 10.2 requires **VNet flow logs (replacing NSG flow logs), PostgreSQL logging, traffic analytics, and comprehensive audit trails**.\n\n>  **Note:** NSG flow logs will be retired on September 30, 2027. Microsoft recommends migrating to **Virtual Network (VNet) flow logs** for improved coverage.\n\n### ğŸ“ Virtual Network Flow Logs & NSG Flow Logs"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.2"
            },
            "name": "text - article 10.2 header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/virtualnetworks'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend vnetName = name\n| extend subnets = array_length(properties.subnets)\n| extend addressPrefixes = strcat_array(properties.addressSpace.addressPrefixes, ', ')\n| extend flowLogsEnabled = isnotnull(properties.flowLogs) and array_length(properties.flowLogs) > 0\n| extend DORAStatus = case(\n    flowLogsEnabled, 'VNet Flow Logs Enabled',\n    subnets > 0, 'VNet Active - Verify Flow Logs',\n    'ğŸ“‹ No Subnets'\n)\n| project \n    VNetName = vnetName,\n    DORAStatus,\n    AddressSpace = addressPrefixes,\n    SubnetCount = subnets,\n    FlowLogsEnabled = case(flowLogsEnabled, 'Yes', 'No'),\n    ResourceGroup = resourceGroup,\n    Subscription = subscriptionId,\n    Location = location,\n    DORAArticle = '10.2',\n    ResourceID = id\n| order by DORAStatus asc, VNetName asc",
              "size": 0,
              "title": "Virtual Networks - Flow Log Configuration (Article 10.2)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "VNetName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORAStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Verify",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "info",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "SubnetCount",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "FlowLogsEnabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": " {0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": " {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "ResourceID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.2"
            },
            "name": "query - dora vnet flow logs"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/networksecuritygroups'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend nsgId = id\n| extend nsgName = name\n| extend subnetCount = array_length(properties.subnets)\n| extend nicCount = array_length(properties.networkInterfaces)\n| extend rulesCount = array_length(properties.securityRules)\n| extend hasFlowLogs = isnotnull(properties.flowLogs) and array_length(properties.flowLogs) > 0\n| extend DORAStatus = case(\n    hasFlowLogs, 'NSG Flow Logs Enabled',\n    subnetCount > 0 or nicCount > 0, 'Attached - No Flow Logs (Migrate to VNet)',\n    'ğŸ“‹ Not Attached'\n)\n| project \n    NSGName = nsgName,\n    DORAStatus,\n    SecurityRules = rulesCount,\n    AttachedSubnets = subnetCount,\n    AttachedNICs = nicCount,\n    FlowLogsEnabled = case(hasFlowLogs, 'Yes', 'No'),\n    ResourceGroup = resourceGroup,\n    Subscription = subscriptionId,\n    Location = location,\n    DORAArticle = '10.2',\n    ResourceID = nsgId\n| order by DORAStatus asc, NSGName asc",
              "size": 0,
              "title": "Network Security Groups - Flow Log Requirements (Article 10.2)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "NSGName",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORAStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Migrate",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "info",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "AttachedSubnets",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "AttachedNICs",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "purple"
                    }
                  },
                  {
                    "columnMatch": "FlowLogsEnabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Yes",
                          "representation": "success",
                          "text": " {0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": " {0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "ResourceID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.2"
            },
            "name": "query - dora nsg"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.dbforpostgresql/flexibleservers'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend version = tostring(properties.version)\n| extend haMode = tostring(properties.highAvailability.mode)\n| extend state = tostring(properties.state)\n| extend logCheckpoints = tobool(properties.dataEncryption)\n| extend DORACompliance = case(\n    state == 'Ready', 'Server Ready',\n    'Check Status'\n)\n| project \n    ['PostgreSQL Server'] = name,\n    ['DORA Status'] = DORACompliance,\n    ['Version'] = version,\n    ['HA Mode'] = haMode,\n    ['State'] = state,\n    ['Resource Group'] = resourceGroup,\n    ['Subscription'] = subscriptionId,\n    Location = location,\n    ['DORA Article'] = '10.2 - Logging',\n    ['Resource ID'] = id\n| order by ['PostgreSQL Server'] asc",
              "size": 0,
              "title": "PostgreSQL Flexible Servers - Logging Configuration (Article 10.2)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "PostgreSQL Server",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Ready",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Ready",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "warning",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Subscription",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Resource ID",
                    "formatter": 5
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "10.2"
            },
            "name": "query - dora postgresql logging"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ“Š DORA Compliance Analytics\n\n### Multi-Subscription Compliance Heatmap"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "text - analytics header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Multi-Subscription DORA Compliance Heatmap\nresourcecontainers\n| where type =~ 'microsoft.resources/subscriptions'\n| project subscriptionId, Subscription = name\n| join kind=leftouter (\n    resources\n    | where type in~ ('microsoft.compute/virtualmachines', 'microsoft.compute/virtualmachinescalesets', 'microsoft.containerservice/managedclusters')\n    | extend isCompliant = isnotempty(zones)\n    | summarize Total93a = count(), Compliant93a = countif(isCompliant) by subscriptionId\n    | extend Art93a = iff(Total93a > 0, round(todouble(Compliant93a) / todouble(Total93a) * 100, 0), 100.0)\n) on subscriptionId\n| join kind=leftouter (\n    resources\n    | where type =~ 'microsoft.keyvault/vaults'\n    | extend isCompliant = tobool(properties.enableRbacAuthorization) == true\n    | summarize Total93b = count(), Compliant93b = countif(isCompliant) by subscriptionId\n    | extend Art93b = iff(Total93b > 0, round(todouble(Compliant93b) / todouble(Total93b) * 100, 0), 100.0)\n) on subscriptionId\n| join kind=leftouter (\n    resources\n    | where type =~ 'microsoft.storage/storageaccounts'\n    | extend isCompliant = tobool(properties.supportsHttpsTrafficOnly) == true\n    | summarize Total93c = count(), Compliant93c = countif(isCompliant) by subscriptionId\n    | extend Art93c = iff(Total93c > 0, round(todouble(Compliant93c) / todouble(Total93c) * 100, 0), 100.0)\n) on subscriptionId\n| join kind=leftouter (\n    resources\n    | where type =~ 'microsoft.sql/servers'\n    | extend isCompliant = tobool(properties.administrators.azureADOnlyAuthentication) == true\n    | summarize Total93d = count(), Compliant93d = countif(isCompliant) by subscriptionId\n    | extend Art93d = iff(Total93d > 0, round(todouble(Compliant93d) / todouble(Total93d) * 100, 0), 100.0)\n) on subscriptionId\n| extend Art93a = coalesce(Art93a, 100.0)\n| extend Art93b = coalesce(Art93b, 100.0)\n| extend Art93c = coalesce(Art93c, 100.0)\n| extend Art93d = coalesce(Art93d, 100.0)\n| extend Overall = round((Art93a + Art93b + Art93c + Art93d) / 4, 0)\n| project Subscription, Art93a, Art93b, Art93c, Art93d, Overall\n| order by Overall asc",
              "size": 0,
              "title": "ğŸ—ºï¸ Multi-Subscription DORA Compliance Heatmap",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Art93a",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "redGreen"
                    }
                  },
                  {
                    "columnMatch": "Art93b",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "redGreen"
                    }
                  },
                  {
                    "columnMatch": "Art93c",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "redGreen"
                    }
                  },
                  {
                    "columnMatch": "Art93d",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "redGreen"
                    }
                  },
                  {
                    "columnMatch": "Overall",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "redGreen"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_heatmap_Overall_5",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_heatmap_Overall_5",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "customWidth": "100",
            "name": "query - multi-subscription heatmap"
          },
          {
            "type": 1,
            "content": {
              "json": "### Compliance Distribution by Resource Type"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "text - resource type header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| where type in~ (\n    'microsoft.compute/virtualmachines',\n    'microsoft.compute/virtualmachinescalesets',\n    'microsoft.network/loadbalancers',\n    'microsoft.network/publicipaddresses',\n    'microsoft.network/applicationgateways',\n    'microsoft.network/azurefirewalls',\n    'microsoft.storage/storageaccounts',\n    'microsoft.sql/servers/databases',\n    'microsoft.containerservice/managedclusters',\n    'microsoft.web/sites',\n    'microsoft.keyvault/vaults',\n    'microsoft.containerregistry/registries',\n    'microsoft.documentdb/databaseaccounts',\n    'microsoft.dbforpostgresql/flexibleservers',\n    'microsoft.dbformysql/flexibleservers',\n    'microsoft.cache/redis',\n    'microsoft.eventhub/namespaces',\n    'microsoft.servicebus/namespaces',\n    'microsoft.apimanagement/service'\n)\n| extend hasZones = isnotempty(zones)\n| extend \n    resourceType = case(\n        type =~ 'microsoft.compute/virtualmachines', 'Virtual Machines',\n        type =~ 'microsoft.compute/virtualmachinescalesets', 'VM Scale Sets',\n        type =~ 'microsoft.network/loadbalancers', 'Load Balancers',\n        type =~ 'microsoft.network/publicipaddresses', 'Public IPs',\n        type =~ 'microsoft.network/applicationgateways', 'App Gateways',\n        type =~ 'microsoft.network/azurefirewalls', 'Azure Firewalls',\n        type =~ 'microsoft.storage/storageaccounts', 'Storage Accounts',\n        type =~ 'microsoft.sql/servers/databases', 'SQL Databases',\n        type =~ 'microsoft.containerservice/managedclusters', 'AKS Clusters',\n        type =~ 'microsoft.web/sites', 'App Services',\n        type =~ 'microsoft.keyvault/vaults', 'Key Vaults',\n        type =~ 'microsoft.containerregistry/registries', 'Container Registries',\n        type =~ 'microsoft.documentdb/databaseaccounts', 'Cosmos DB',\n        type =~ 'microsoft.dbforpostgresql/flexibleservers', 'PostgreSQL',\n        type =~ 'microsoft.dbformysql/flexibleservers', 'MySQL',\n        type =~ 'microsoft.cache/redis', 'Redis Cache',\n        type =~ 'microsoft.eventhub/namespaces', 'Event Hubs',\n        type =~ 'microsoft.servicebus/namespaces', 'Service Bus',\n        type =~ 'microsoft.apimanagement/service', 'API Management',\n        type\n    )\n| summarize \n    Total = count(),\n    Compliant = countif(hasZones),\n    NonCompliant = countif(not(hasZones))\n    by resourceType\n| extend ComplianceRate = iff(Total == 0, 0.0, round(todouble(Compliant) / todouble(Total) * 100, 1))\n| order by ComplianceRate asc\n| project \n    ['Resource Type'] = resourceType,\n    ['Compliance %'] = ComplianceRate",
              "size": 0,
              "title": "Zone Redundancy Compliance by Resource Type (All DORA Articles)",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "visualization": "barchart",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Compliance %",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "greenRed"
                    }
                  }
                ],
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "query - dora by type"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| where type in~ (\n    'microsoft.compute/virtualmachines',\n    'microsoft.network/loadbalancers',\n    'microsoft.network/publicipaddresses',\n    'microsoft.storage/storageaccounts',\n    'microsoft.sql/servers/databases',\n    'microsoft.containerservice/managedclusters',\n    'microsoft.keyvault/vaults',\n    'microsoft.containerregistry/registries'\n)\n| extend hasZones = isnotempty(zones)\n| summarize \n    Total = count(),\n    Compliant = countif(hasZones),\n    NonCompliant = countif(not(hasZones))\n    by location\n| extend ComplianceRate = round(todouble(Compliant) / todouble(Total) * 100, 2)\n| order by NonCompliant desc\n| project \n    ['Azure Region'] = location,\n    ['Total Resources'] = Total,\n    ['Compliant'] = Compliant,\n    ['At Risk'] = NonCompliant,\n    ['Compliance Rate %'] = ComplianceRate",
              "size": 0,
              "title": "DORA Compliance by Azure Region",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Compliant",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "green"
                    }
                  },
                  {
                    "columnMatch": "At Risk",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "red"
                    }
                  },
                  {
                    "columnMatch": "Compliance Rate %",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "greenRed",
                      "aggregation": "Average"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "query - dora by region"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ“‹ Subscription-Level DORA Compliance Overview"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "text - subscription header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| where type in~ (\n    'microsoft.compute/virtualmachines',\n    'microsoft.network/loadbalancers',\n    'microsoft.network/publicipaddresses',\n    'microsoft.storage/storageaccounts',\n    'microsoft.sql/servers/databases',\n    'microsoft.containerservice/managedclusters',\n    'microsoft.web/sites',\n    'microsoft.keyvault/vaults',\n    'microsoft.containerregistry/registries'\n)\n| extend hasZones = isnotempty(zones)\n| summarize \n    TotalResources = count(),\n    ZoneCompliant = countif(hasZones),\n    AtRisk = countif(not(hasZones)),\n    ResourceTypes = dcount(type)\n    by subscriptionId\n| extend ComplianceRate = round(todouble(ZoneCompliant) / todouble(TotalResources) * 100, 2)\n| extend DORAStatus = case(\n    ComplianceRate >= 90, 'Excellent',\n    ComplianceRate >= 75, 'ğŸŸ¡ Good',\n    ComplianceRate >= 50, 'ğŸŸ  Needs Action',\n    'Critical'\n)\n| order by AtRisk desc\n| project \n    ['Subscription ID'] = subscriptionId,\n    ['DORA Status'] = DORAStatus,\n    ['Total Resources'] = TotalResources,\n    ['Compliant'] = ZoneCompliant,\n    ['At Risk'] = AtRisk,\n    ['Compliance %'] = ComplianceRate,\n    ['Resource Types'] = ResourceTypes",
              "size": 0,
              "title": "DORA Compliance by Subscription",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Subscription ID",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Excellent",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "ğŸŸ¡",
                          "representation": "available",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "ğŸŸ ",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Compliant",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "green"
                    }
                  },
                  {
                    "columnMatch": "At Risk",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "red"
                    }
                  },
                  {
                    "columnMatch": "Compliance %",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "greenRed",
                      "aggregation": "Average"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 2,
                        "maximumFractionDigits": 2
                      }
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "query - dora by subscription"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸ”— Private Endpoints by Tenant and Subscription"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "text - pe subscription summary header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/privateendpoints'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend tenantId = tostring(tenantId)\n| extend subscriptionId = tostring(subscriptionId)\n| summarize \n    ['Private Endpoints Count'] = count(),\n    ['Resource Groups'] = dcount(resourceGroup),\n    Locations = dcount(location)\n    by tenantId, subscriptionId\n| order by ['Private Endpoints Count'] desc\n| project \n    ['Tenant ID'] = tenantId,\n    ['Subscription ID'] = subscriptionId,\n    ['Private Endpoints Count'],\n    ['Resource Groups'],\n    Locations",
              "size": 0,
              "title": "Private Endpoints by Tenant and Subscription (Article 9.3a)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Tenant ID",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "35ch"
                    }
                  },
                  {
                    "columnMatch": "Subscription ID",
                    "formatter": 15,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "customColumnWidthSetting": "35ch",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "Private Endpoints Count",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Private Endpoints Count",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Private Endpoints Count",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "query - pe subscription summary"
          },
          {
            "type": 1,
            "content": {
              "json": "### ğŸŒ Cross-Subscription and Cross-Tenant Private Endpoints\n\n>  **Security Alert:** Cross-tenant private endpoints require additional scrutiny for DORA compliance as they may connect to resources outside your organization's governance scope."
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "text - cross tenant pe header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type =~ 'microsoft.network/privateendpoints'\n| where '*' in ({ResourceGroups}) or resourceGroup in ({ResourceGroups})\n| extend peSubscriptionId = tostring(subscriptionId)\n| extend peTenantId = tostring(tenantId)\n| mv-expand privateLinkServiceConnection = properties.privateLinkServiceConnections\n| extend targetResourceId = tostring(privateLinkServiceConnection.properties.privateLinkServiceId)\n| extend targetResourceIdLower = tolower(targetResourceId)\n| extend targetSubscriptionId = tostring(split(targetResourceId, '/')[2])\n| extend connectionState = tostring(privateLinkServiceConnection.properties.privateLinkServiceConnectionState.status)\n| extend isCrossSubscription = iff(peSubscriptionId != targetSubscriptionId and targetSubscriptionId != '', 'Yes', 'No')\n| join kind=leftouter (\n    resources\n    | extend targetTenantId = tostring(tenantId)\n    | extend idLower = tolower(id)\n    | project idLower, targetTenantId\n) on $left.targetResourceIdLower == $right.idLower\n| extend finalTargetTenant = iff(isempty(targetTenantId), iff(isempty(targetSubscriptionId), 'N/A', peTenantId), targetTenantId)\n| extend isCrossTenant = iff(isempty(targetTenantId) and isnotempty(targetSubscriptionId), iff(peSubscriptionId != targetSubscriptionId, 'Unknown - Verify Access', 'No'), iff(isempty(targetTenantId), 'Unknown', iff(peTenantId != targetTenantId, 'Yes', 'No')))\n| extend DORAStatus = case(\n    isCrossTenant == 'Yes', 'Cross-Tenant - Review Required',\n    isCrossTenant == 'Unknown - Verify Access', 'Verify Target Resource Access',\n    isCrossSubscription == 'Yes', 'Cross-Subscription',\n    'Same Subscription'\n)\n| project \n    ['Private Endpoint'] = name,\n    ['DORA Status'] = DORAStatus,\n    ['Connection State'] = connectionState,\n    ['PE Tenant'] = peTenantId,\n    ['PE Subscription'] = peSubscriptionId,\n    ['PE Resource Group'] = resourceGroup,\n    ['Target Tenant'] = finalTargetTenant,\n    ['Target Subscription'] = targetSubscriptionId,\n    ['Target Resource'] = tostring(split(targetResourceId, '/')[-1]),\n    Location = location\n| order by ['DORA Status'] asc, ['Private Endpoint'] asc",
              "size": 0,
              "title": "Cross-Subscription & Cross-Tenant Private Endpoints (DORA Security Review)",
              "showExportToExcel": true,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscriptions}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Private Endpoint",
                    "formatter": 1,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkColumn": "Resource ID"
                    }
                  },
                  {
                    "columnMatch": "DORA Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Cross-Tenant",
                          "representation": "critical",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Cross-Subscription",
                          "representation": "warning",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Connection State",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Approved",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Pending",
                          "representation": "pending",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "failed",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "PE Tenant",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "PE Subscription",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Target Tenant",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Cross-Tenant",
                          "representation": "redBright",
                          "text": " {0}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": null,
                          "text": "{0}"
                        }
                      ],
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Target Subscription",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "query - cross tenant pe"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ“‹ DORA 2022/2554 Compliance Recommendations\n\n### ğŸ¯ Priority Actions by DORA Article\n\n#### ** HIGH PRIORITY - Article 9.3a (ICT Systems Availability)**\n| Priority | Recommendation | Impact |\n|----------|----------------|--------|\n| 1 | **Enable Availability Zones** for all critical compute resources (VMs, VMSS, AKS) | Operational continuity |\n| 2 | **Configure Zone-Redundant Load Balancers** for production workloads | High availability |\n| 3 | **Implement ZRS/GZRS Storage** for all business-critical data | Data durability |\n| 4 | **Deploy Private Endpoints** for all PaaS services | Network isolation |\n| 5 | **Enforce TLS 1.2+** for all services | Secure communications |\n\n#### **ğŸŸ  MEDIUM PRIORITY - Article 9.3b (Access Control)**\n| Priority | Recommendation | Impact |\n|----------|----------------|--------|\n| 6 | **Enable Key Vault RBAC** authorization | Access governance |\n| 7 | **Configure Soft Delete and Purge Protection** for Key Vaults | Data protection |\n| 8 | **Disable Container Registry admin user** | Secure access |\n| 9 | **Implement Customer Managed Keys (CMK)** where applicable | Encryption control |\n\n#### **ğŸŸ¡ STANDARD PRIORITY - Articles 9.3c/9.3d/10.x**\n| Priority | Recommendation | Impact |\n|----------|----------------|--------|\n| 10 | **Enable Azure AD-Only Authentication** for SQL/MySQL | Identity security |\n| 11 | **Deploy Microsoft Defender** for all supported resources | Threat detection |\n| 12 | **Enable VNet Flow Logs** (replacing NSG Flow Logs) with Traffic Analytics | Incident detection |\n| 13 | **Configure Geo-Redundant Backup** for all databases | Disaster recovery |\n| 14 | **Enable PostgreSQL logging** (log_checkpoints, log_connections) | Audit trail |\n\n---\n\n### ğŸ“Š DORA Policy Groups Coverage Summary\n\n| DORA Article | Policy Group | Controls Covered | Key Focus |\n|--------------|--------------|------------------|----------|\n| **9.3a** | DORA_2022_2554_9.3a | ~40 policies | SSL/TLS, Private Endpoints, Secure Transfer, Zone Redundancy |\n| **9.3b** | DORA_2022_2554_9.3b | ~35 policies | RBAC, Backup, CMK Encryption, Geo-Redundancy |\n| **9.3c** | DORA_2022_2554_9.3c | ~45 policies | Key Rotation, System Updates, Data Encryption, Soft Delete |\n| **9.3d** | DORA_2022_2554_9.3d | ~10 policies | AAD-Only Auth, Multiple Owners |\n| **10.1** | DORA_2022_2554_10.1 | ~15 policies | Defender Services, Activity Logs, Resource Logs |\n| **10.2** | DORA_2022_2554_10.2 | ~10 policies | NSG Flow Logs, PostgreSQL Logging, Traffic Analytics |\n\n---\n\n### â±ï¸ Compliance Timeline Recommendation\n\n| Phase | Timeline | Focus Areas | Target |\n|-------|----------|-------------|--------|\n| **Phase 1** | 0-3 months | HIGH PRIORITY - Zone redundancy, Private endpoints, TLS | 80% Article 9.3a compliance |\n| **Phase 2** | 3-6 months | MEDIUM PRIORITY - RBAC, CMK, Key Vault protection | 80% Article 9.3b/c compliance |\n| **Phase 3** | 6-9 months | STANDARD PRIORITY - Defender, Logging, Identity | 80% Article 10.x compliance |\n| **Phase 4** | 9-12 months | Full compliance and continuous monitoring | 95%+ overall compliance |\n\n---\n\n### ğŸ“Œ DORA Regulatory Reference\n\n**Regulation (EU) 2022/2554** - Digital Operational Resilience Act\n\n| Aspect | Details |\n|--------|----------|\n| **Effective Date** | January 17, 2025 |\n| **Applies to** | Financial entities in the EU (banks, insurance, investment firms, crypto-asset providers) |\n| **Scope** | ICT risk management, incident reporting, resilience testing, third-party risk |\n| **Penalties** | Up to 2% of total annual worldwide turnover |\n\n### ğŸ”— Resources\n- [DORA Official Text](https://eur-lex.europa.eu/eli/reg/2022/2554/oj)\n- [Azure Policy Initiative for DORA](https://learn.microsoft.com/azure/governance/policy/samples/built-in-initiatives#regulatory-compliance)\n- [Microsoft Cloud for Financial Services](https://www.microsoft.com/en-us/industry/financial-services/microsoft-cloud-for-financial-services)"
            },
            "conditionalVisibility": {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Analytics"
            },
            "name": "text - recommendations"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n##  DORA Policy Controls Requiring Azure Policy\n\nThe following DORA controls **cannot be fully queried via Azure Resource Graph (ARG)** and require **Azure Policy** for compliance assessment.\n\n### ğŸ”§ Azure Policy-Only Controls\n\n| Policy Control | DORA Article | Reason | Azure Policy Reference |\n|----------------|--------------|--------|------------------------|\n| **Azure Backup for VMs** | 9.3a | Backup configuration stored in Recovery Services vault, not on VM resource | [Azure Backup policy](https://learn.microsoft.com/azure/governance/policy/samples/built-in-policies#backup) |\n| **Geo-redundant backup** | 9.3a | Backup redundancy requires Recovery Services vault query | [Built-in Backup policies](https://learn.microsoft.com/azure/governance/policy/samples/built-in-policies#backup) |\n| **Microsoft Antimalware auto-update** | 9.3c | Guest configuration - requires Azure Policy Guest Config extension | [Antimalware policy](https://learn.microsoft.com/azure/virtual-machines/security-policy) |\n| **Windows Defender Exploit Guard** | 9.3c | Windows guest configuration only | [Guest Configuration overview](https://learn.microsoft.com/azure/governance/machine-configuration/overview) |\n| **Key Vault key expiration** | 9.3c | Individual key properties (`microsoft.keyvault/vaults/keys`) not in ARG | [Key Vault policies](https://learn.microsoft.com/azure/governance/policy/samples/built-in-policies#key-vault) |\n| **Key rotation period** | 9.3c | Key rotation tracked via Key Vault events, not ARG | [Key rotation policy](https://learn.microsoft.com/azure/key-vault/keys/how-to-configure-key-rotation) |\n| **HDInsight encryption at rest** | 9.3c | Requires disk encryption validation | [HDInsight disk encryption](https://learn.microsoft.com/azure/hdinsight/disk-encryption) |\n| **Database CMK validation** | 9.3c | Some CMK properties not fully exposed in ARG | [SQL TDE with CMK](https://learn.microsoft.com/azure/azure-sql/database/transparent-data-encryption-byok-overview) |\n\n###  Now Queryable via ARG\n\n| Policy Control | DORA Article | Query Added | Tab |\n|----------------|--------------|-------------|-----|\n| **Multiple subscription owners** | 9.3d | Uses `authorizationresources` table to count Owner role assignments | 9.3d Identity |\n| **Activity log diagnostic settings** | 10.1 | Uses `microsoft.insights/diagnosticsettings` to verify log export | 10.1 Detection |\n| **Resource diagnostic settings** | 10.1 | Joins diagnostic settings with parent resources for coverage analysis | 10.1 Detection |\n\n### ğŸ“š DORA Regulatory Compliance Initiative\n\nFor comprehensive DORA compliance, deploy the **DORA 2022/2554 Azure Policy Initiative**:\n\n- ğŸ“„ [DORA regulatory compliance built-in initiative](https://learn.microsoft.com/azure/governance/policy/samples/built-in-initiatives#regulatory-compliance)\n- ğŸ“„ [Regulatory Compliance in Azure Policy](https://learn.microsoft.com/azure/governance/policy/concepts/regulatory-compliance)\n- ğŸ“„ [Azure Policy built-in definitions](https://learn.microsoft.com/azure/governance/policy/samples/built-in-policies)\n- ğŸ“„ [Guest Configuration overview](https://learn.microsoft.com/azure/governance/machine-configuration/overview)\n\n### ğŸ” Complementary Tools\n\nThis workbook provides **real-time ARG queries** for resources with queryable properties. For complete coverage:\n\n| Tool | Purpose | Link |\n|------|---------|------|\n| **Microsoft Defender for Cloud** | Continuous security assessment, recommendations | [Defender for Cloud](https://learn.microsoft.com/azure/defender-for-cloud/defender-for-cloud-introduction) |\n| **Azure Policy** | Policy enforcement, guest configuration | [Azure Policy](https://learn.microsoft.com/azure/governance/policy/overview) |\n| **Microsoft Secure Score** | Security posture measurement | [Secure Score](https://learn.microsoft.com/azure/defender-for-cloud/secure-score-security-controls) |\n| **Regulatory Compliance Dashboard** | Built-in compliance standards | [Compliance dashboard](https://learn.microsoft.com/azure/defender-for-cloud/regulatory-compliance-dashboard) |\n\n> ğŸ’¡ **Recommendation**: Deploy the DORA 2022/2554 Azure Policy initiative alongside this workbook for 100% policy coverage."
            },
            "conditionalVisibility": {
              "parameterName": "ShowHelp",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - policy gaps documentation"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedCategoryTab",
        "comparison": "isEqualTo",
        "value": "Dashboard"
      },
      "name": "dashboard-group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# âš™ï¸ Compliance Threshold Configuration\n\n> Configure the percentage thresholds that determine compliance status colors across all DORA dashboard tiles.\n\n---\n\n## ğŸ“Š How Thresholds Work\n\nThe dashboard evaluates each DORA requirement by calculating the **percentage of compliant resources** across your Azure environment.\n\n**Example Calculation**: If 85 out of 100 VMs have Zone Redundancy enabled, your compliance score is **85%**.\n\nThis score is then compared against your configured thresholds to determine the visual status:\n\n| Status | Color | Criteria | Visual Indicator |\n|--------|-------|----------|-----------------|\n| **Excellent** | ğŸŸ¢ Green | Score â‰¥ Excellent Threshold | Exceeds compliance goals |\n| **Good** | ğŸŸ¡ Yellow | Score â‰¥ Good Threshold | Meets minimum standards |\n| **Warning** | ğŸŸ  Orange | Score â‰¥ Warning Threshold | Requires attention |\n| **Critical** |  Red | Score < Warning Threshold | Immediate action needed |\n\n---\n\n## ğŸ¯ Setting Appropriate Thresholds\n\n**Best Practices**:\n- Set **Excellent** thresholds based on your target compliance goals (typically 85-95%)\n- Set **Good** thresholds at your minimum acceptable level (typically 70-80%)\n- Set **Warning** thresholds to catch declining compliance early (typically 40-60%)\n- Higher thresholds = stricter compliance standards\n\n**Example Configuration**:\nIf you set Zone Redundancy thresholds to **90% / 75% / 50%**:\n- **92% compliance** â†’ ğŸŸ¢ Excellent (exceeds 90% target)\n- **80% compliance** â†’ ğŸŸ¡ Good (exceeds 75% minimum)\n- **60% compliance** â†’ ğŸŸ  Warning (exceeds 50% floor)\n- **40% compliance** â†’  Critical (below 50% floor)\n\n---\n\n## ğŸ“‹ Configure Thresholds by DORA Article\n\nExpand each section below to adjust thresholds for specific compliance metrics."
            },
            "name": "text - thresholds introduction"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "ğŸ¯ Article 9.3a - ICT Systems Availability & Continuity",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### ğŸ—ï¸ Zone Redundancy Compliance\n\n**What it measures**: Percentage of compute resources (VMs, VMSS) deployed with Availability Zone support for high availability.\n\n**Recommended thresholds**: 90% / 75% / 50%"
                  },
                  "name": "text - zone redundancy header"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "threshold-zone-excellent",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdZoneExcellent",
                        "label": "ğŸŸ¢ Excellent",
                        "type": 1,
                        "description": "Percentage threshold for Excellent status (green tile)",
                        "value": "90",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-zone-good",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdZoneGood",
                        "label": "ğŸŸ¡ Good",
                        "type": 1,
                        "description": "Percentage threshold for Good status (yellow tile)",
                        "value": "75",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-zone-warning",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdZoneWarning",
                        "label": "ğŸŸ  Warning",
                        "type": 1,
                        "description": "Percentage threshold for Warning status (orange tile)",
                        "value": "50",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-zone-critical",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdZoneCritical",
                        "label": "Critical",
                        "type": 1,
                        "description": "Percentage threshold for Critical status (red tile)",
                        "value": "25",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - zone redundancy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "---\n\n### ğŸ”’ PaaS Network Isolation Coverage\n\n**What it measures**: Percentage of PaaS resources (Storage, SQL, Key Vault, etc.) using Private Endpoints or Network Security Perimeters.\n\n**Recommended thresholds**: 90% / 75% / 50%"
                  },
                  "name": "text - paas network header"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "threshold-paas-excellent",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdPaaSExcellent",
                        "label": "ğŸŸ¢ Excellent",
                        "type": 1,
                        "description": "Percentage threshold for Excellent status (green tile)",
                        "value": "90",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-paas-good",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdPaaSGood",
                        "label": "ğŸŸ¡ Good",
                        "type": 1,
                        "description": "Percentage threshold for Good status (yellow tile)",
                        "value": "75",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-paas-warning",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdPaaSWarning",
                        "label": "ğŸŸ  Warning",
                        "type": 1,
                        "description": "Percentage threshold for Warning status (orange tile)",
                        "value": "50",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-paas-critical",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdPaaSCritical",
                        "label": " Critical",
                        "type": 1,
                        "description": "Percentage threshold for Critical status (red tile)",
                        "value": "25",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - paas network"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "---\n\n### ğŸ” Secure Transfer (HTTPS/TLS) Enforcement\n\n**What it measures**: Percentage of data services enforcing HTTPS-only connections with TLS 1.2+ (Storage, Redis, SQL, etc.).\n\n**Recommended thresholds**: 95% / 80% / 50%"
                  },
                  "name": "text - https header"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "threshold-https-excellent",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdHTTPSExcellent",
                        "label": "ğŸŸ¢ Excellent",
                        "type": 1,
                        "description": "Percentage threshold for Excellent status (green tile)",
                        "value": "95",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-https-good",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdHTTPSGood",
                        "label": "ğŸŸ¡ Good",
                        "type": 1,
                        "description": "Percentage threshold for Good status (yellow tile)",
                        "value": "80",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-https-warning",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdHTTPSWarning",
                        "label": "ğŸŸ  Warning",
                        "type": 1,
                        "description": "Percentage threshold for Warning status (orange tile)",
                        "value": "50",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-https-critical",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdHTTPSCritical",
                        "label": " Critical",
                        "type": 1,
                        "description": "Percentage threshold for Critical status (red tile)",
                        "value": "25",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - https"
                }
              ]
            },
            "name": "group - availability thresholds"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "ğŸ” Article 9.3b - Access Control & Authorization",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### ğŸ”‘ Key Vault RBAC Authorization\n\n**What it measures**: Percentage of Key Vaults using Azure RBAC (role-based access control) instead of legacy vault access policies.\n\n**Recommended thresholds**: 90% / 70% / 40%"
                  },
                  "name": "text - kv rbac header"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "threshold-kv-excellent",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdKVExcellent",
                        "label": "ğŸŸ¢ Excellent",
                        "type": 1,
                        "description": "Percentage threshold for Excellent status (green tile)",
                        "value": "90",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-kv-good",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdKVGood",
                        "label": "ğŸŸ¡ Good",
                        "type": 1,
                        "description": "Percentage threshold for Good status (yellow tile)",
                        "value": "70",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-kv-warning",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdKVWarning",
                        "label": "ğŸŸ  Warning",
                        "type": 1,
                        "description": "Percentage threshold for Warning status (orange tile)",
                        "value": "40",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-kv-critical",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdKVCritical",
                        "label": " Critical",
                        "type": 1,
                        "description": "Percentage threshold for Critical status (red tile)",
                        "value": "20",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - kv rbac"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "---\n\n### ğŸ‘¤ Azure AD-Only Authentication\n\n**What it measures**: Percentage of SQL/MySQL/PostgreSQL databases enforcing Azure AD-only authentication (local SQL authentication disabled).\n\n**Recommended thresholds**: 90% / 70% / 40%"
                  },
                  "name": "text - aad auth header"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "threshold-aad-excellent",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdAADExcellent",
                        "label": "ğŸŸ¢ Excellent",
                        "type": 1,
                        "description": "Percentage threshold for Excellent status (green tile)",
                        "value": "90",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-aad-good",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdAADGood",
                        "label": "ğŸŸ¡ Good",
                        "type": 1,
                        "description": "Percentage threshold for Good status (yellow tile)",
                        "value": "70",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-aad-warning",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdAADWarning",
                        "label": "ğŸŸ  Warning",
                        "type": 1,
                        "description": "Percentage threshold for Warning status (orange tile)",
                        "value": "40",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-aad-critical",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdAADCritical",
                        "label": " Critical",
                        "type": 1,
                        "description": "Percentage threshold for Critical status (red tile)",
                        "value": "20",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - access control thresholds"
                }
              ]
            },
            "name": "group - access control thresholds"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "ğŸ” Article 10.1 - Detection & Monitoring",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "threshold-defender-good",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdDefenderGood",
                        "label": "ğŸŸ¡ Microsoft Defender Coverage - Good (%)",
                        "type": 1,
                        "description": "Percentage threshold for Good status (yellow tile)",
                        "value": "70",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-defender-warning",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdDefenderWarning",
                        "label": "ğŸŸ  Microsoft Defender Coverage - Warning (%)",
                        "type": 1,
                        "description": "Percentage threshold for Warning status (orange tile)",
                        "value": "40",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-nsg-excellent",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdNSGExcellent",
                        "label": "ğŸŸ¢ NSG Flow Logs - Excellent (%)",
                        "type": 1,
                        "description": "Percentage threshold for Excellent status (green tile)",
                        "value": "90",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-nsg-good",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdNSGGood",
                        "label": "ğŸŸ¡ NSG Flow Logs - Good (%)",
                        "type": 1,
                        "description": "Percentage threshold for Good status (yellow tile)",
                        "value": "70",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-nsg-warning",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdNSGWarning",
                        "label": "ğŸŸ  NSG Flow Logs - Warning (%)",
                        "type": 1,
                        "description": "Percentage threshold for Warning status (orange tile)",
                        "value": "40",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - monitoring thresholds"
                }
              ]
            },
            "name": "group - monitoring thresholds"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "âš ï¸ Article 9.3a - Business Continuity Risk Assessment",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "### ğŸš¨ Business Continuity Risk Assessment\n\n**What it measures**: Percentage of resources at risk for business continuity failures (lacking backups, geo-redundancy, or zone redundancy).\n\n**Recommended thresholds**: Low Risk < 10% / Medium Risk 10-24% / High Risk â‰¥ 25%\n\n> ğŸ’¡ **Critical Note - Inverse Logic**: These thresholds work **opposite** to other metrics:\n> - **Lower % = Better** (measures resources AT RISK, not compliant)\n> - 5% at risk = ğŸŸ¢ Excellent (95% protected)\n> - 30% at risk =  Critical (only 70% protected)\n\n**Threshold Interpretation**:\n- ğŸŸ¢ **Low Risk** (< Low Risk threshold): Excellent business continuity posture\n- ğŸŸ¡ **Medium Risk** (â‰¥ Medium Risk threshold): Needs attention and remediation planning\n-  **High Risk** (â‰¥ High Risk threshold): Critical - immediate action required\n- âš« **Critical Failure** (â‰¥ 50%): Unacceptable for DORA compliance"
                  },
                  "name": "text - risk header"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [],
                    "parameters": [
                      {
                        "id": "threshold-risk-medium",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdRiskMedium",
                        "label": "ğŸŸ¡ Medium Risk Threshold (%)",
                        "type": 1,
                        "description": "Resources at risk % that triggers Medium Risk (yellow) - typically 10%",
                        "value": "10",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      },
                      {
                        "id": "threshold-risk-high",
                        "version": "KqlParameterItem/1.0",
                        "name": "ThresholdRiskHigh",
                        "label": " High Risk Threshold (%)",
                        "type": 1,
                        "description": "Resources at risk % that triggers High Risk (red) - typically 25%",
                        "value": "25",
                        "typeSettings": {
                          "parameterType": "number"
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - risk"
                }
              ]
            },
            "name": "group - risk thresholds"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ğŸ“‹ Threshold Configuration Reference\n\n### Compliance Metrics (Positive - Higher is Better)\n\nThese metrics measure **percentage of compliant resources**. Higher scores = better compliance.\n\n| DORA Article | Metric | ğŸŸ¢ Excellent | ğŸŸ¡ Good | ğŸŸ  Warning |  Critical |\n|--------------|--------|-------------|---------|-----------|------------|\n| **9.3a - Availability** | Zone Redundancy | â‰¥ 90% | â‰¥ 75% | â‰¥ 50% | â‰¥ 25% |\n| **9.3a - Availability** | PaaS Network Isolation | â‰¥ 90% | â‰¥ 75% | â‰¥ 50% | â‰¥ 25% |\n| **9.3a - Availability** | Secure Transfer (HTTPS/TLS) | â‰¥ 95% | â‰¥ 80% | â‰¥ 50% | â‰¥ 25% |\n| **9.3b - Access Control** | Key Vault RBAC | â‰¥ 90% | â‰¥ 70% | â‰¥ 40% | â‰¥ 20% |\n| **9.3b - Access Control** | AAD-Only Authentication | â‰¥ 90% | â‰¥ 70% | â‰¥ 40% | â‰¥ 20% |\n| **10.1 - Monitoring** | NSG Flow Logs | â‰¥ 90% | â‰¥ 70% | â‰¥ 40% | â‰¥ 20% |\n\n> **Note**: Below Critical threshold (e.g., < 25% or < 20%) represents complete compliance failure.\n\n### Security Coverage Metrics (Binary - Enabled/Disabled)\n\nThese metrics measure **percentage of enabled security plans**. No \"Excellent\" tier because plans are either on or off.\n\n| DORA Article | Metric | ğŸŸ¢ Excellent | ğŸŸ¡ Good | ğŸŸ  Warning |  Critical |\n|--------------|--------|-------------|---------|-----------|------------|\n| **10.1 - Monitoring** | Microsoft Defender Plans | N/A | â‰¥ 70% | â‰¥ 40% | â‰¥ 20% |\n\n> **Why no Excellent?** Defender plans are binary (enabled/disabled). Target is 100% coverage, but \"Good\" threshold at 70% acknowledges budget constraints.\n\n### Risk Assessment Metrics (Inverse - Lower is Better)\n\nThese metrics measure **percentage of resources AT RISK**. Lower scores = better compliance (inverted logic).\n\n| DORA Article | Metric | ğŸŸ¢ Excellent | ğŸŸ¡ Medium Risk | ğŸŸ  Warning |  High Risk |\n|--------------|--------|-------------|---------------|-----------|-------------|\n| **9.3a - Business Continuity** | Resources at Risk | < 10% | â‰¥ 10% | N/A | â‰¥ 25% |\n\n> **Why inverted?** This measures **risk percentage** (not compliance). 5% at risk = ğŸŸ¢ Excellent. 30% at risk =  Critical.\n\n---\n\n## ğŸ¯ Threshold Setting Logic\n\n### Why Different Threshold Levels?\n\n**Excellent (90-95%)**: Aspirational target for mature compliance programs\n- Use for critical controls: encryption, zone redundancy, network isolation\n- Acknowledges some resources may have valid exceptions\n- Typical for regulated industries (financial services, healthcare)\n\n**Good (70-80%)**: Minimum acceptable compliance level\n- Represents \"passing grade\" for most audits\n- Balances security requirements with operational flexibility\n- Starting point for organizations beginning compliance journey\n\n**Warning (40-50%)**: Early warning threshold\n- Triggers attention before compliance becomes critical\n- Allows time for remediation planning\n- Prevents sudden drops into Critical status\n\n**Critical (20-25%)**: Minimum threshold before complete failure\n- Indicates severe systemic compliance failures\n- Represents regulatory non-compliance and high risk\n- Requires immediate executive escalation and remediation\n- Below this threshold (< 20-25%) = Complete compliance failure\n\n### Why Secure Transfer (HTTPS/TLS) has Higher Thresholds?\n\nHTTPS/TLS enforcement is **non-negotiable** for data security:\n- **Excellent = 95%** (vs 90% for other metrics)\n- **Good = 80%** (vs 70-75% for others)\n- Rationale: Unencrypted data transmission is a critical security vulnerability\n- Even a small percentage of unencrypted connections poses significant risk\n\n### Why Defender has No Excellent Tier?\n\nDefender plans are **binary** (on/off), not gradual:\n- Can't be \"partially enabled\" for a resource\n- Either 100% coverage (all plans on) or less\n- \"Good\" threshold (70%) acknowledges:\n  - Budget constraints for smaller organizations\n  - Some plans (e.g., Defender for DNS) may not apply to all environments\n  - Prioritization of critical workloads (Servers, Storage, SQL) over others\n\n### Why Business Continuity Risk is Inverted?\n\nThis metric measures **bad things** (resources at risk), not compliance:\n- **Lower percentages = Better** (opposite of other metrics)\n- 5% at risk â†’ ğŸŸ¢ Excellent (95% of resources are protected)\n- 30% at risk â†’  Critical (70% protected is insufficient)\n- Thresholds:\n  - < 10% at risk = ğŸŸ¢ Excellent (acceptable risk level)\n  - 10-24% at risk = ğŸŸ¡ Medium Risk (needs attention)\n  - â‰¥ 25% at risk =  High Risk (unacceptable for DORA)\n\n---\n\n### ğŸ’¡ Best Practices for Threshold Management\n\n1. **Start Conservative**: Begin with lower thresholds (Good tier) and increase to Excellent as compliance matures\n2. **Industry Benchmarks**: Financial services typically target 85-95% for critical controls, 70-80% for others\n3. **Risk-Based Approach**: \n   - Stricter thresholds for data protection (encryption, network isolation)\n   - More lenient for operational controls (monitoring, logging)\n4. **Regular Review**: Reassess thresholds quarterly based on compliance trends and organizational risk tolerance\n5. **Document Rationale**: Record threshold choices in compliance documentation for audit purposes\n6. **Exception Process**: Establish formal process for resources that cannot meet thresholds (e.g., legacy systems)\n\n---\n\n> â„¹ï¸ **Note**: After changing thresholds, refresh the Dashboard tab to see updated compliance colors and status."
            },
            "name": "text - threshold summary"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "SelectedCategoryTab",
        "comparison": "isEqualTo",
        "value": "Thresholds"
      },
      "name": "thresholds-group"
    }
  ],
  "fallbackResourceIds": [
    "azure monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}